<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marcus Ramalho">

<title>Aula 2 - Análise e otimização de carteiras – Mini-Curso - Explorando finanças com R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./images/ser.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>

<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>

<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/ser.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Mini-Curso - Explorando finanças com R</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Início</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./apresentacao.html"> <i class="bi bi-file-earmark-text" role="img">
</i> 
<span class="menu-text">Apresentação</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./exercicios.html"> <i class="bi bi-file-earmark-text" role="img">
</i> 
<span class="menu-text">Exercícios</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dashboard.html"> <i class="bi bi-file-earmark-text" role="img">
</i> 
<span class="menu-text">Dashboard</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/nextmarte"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">GitHub</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#relembrando-alguns-conceitos-sobre-risco" id="toc-relembrando-alguns-conceitos-sobre-risco" class="nav-link active" data-scroll-target="#relembrando-alguns-conceitos-sobre-risco">Relembrando alguns conceitos sobre risco</a></li>
  <li><a href="#tipos-de-risco" id="toc-tipos-de-risco" class="nav-link" data-scroll-target="#tipos-de-risco">Tipos de risco</a></li>
  <li><a href="#atitudes-frente-ao-risco" id="toc-atitudes-frente-ao-risco" class="nav-link" data-scroll-target="#atitudes-frente-ao-risco">Atitudes frente ao risco</a></li>
  <li><a href="#mensuração-do-risco" id="toc-mensuração-do-risco" class="nav-link" data-scroll-target="#mensuração-do-risco">Mensuração do Risco</a></li>
  <li><a href="#risco-de-carteira" id="toc-risco-de-carteira" class="nav-link" data-scroll-target="#risco-de-carteira">Risco de Carteira</a></li>
  <li><a href="#risco-individual-vs.-sistêmico" id="toc-risco-individual-vs.-sistêmico" class="nav-link" data-scroll-target="#risco-individual-vs.-sistêmico">Risco individual vs.&nbsp;sistêmico</a></li>
  <li><a href="#índice-sharpe-is" id="toc-índice-sharpe-is" class="nav-link" data-scroll-target="#índice-sharpe-is">Índice Sharpe (IS)</a></li>
  <li><a href="#beta-β" id="toc-beta-β" class="nav-link" data-scroll-target="#beta-β">Beta (β)</a></li>
  <li><a href="#alfa-α" id="toc-alfa-α" class="nav-link" data-scroll-target="#alfa-α">Alfa (α)</a></li>
  <li><a href="#função-de-utilidade-quadrática" id="toc-função-de-utilidade-quadrática" class="nav-link" data-scroll-target="#função-de-utilidade-quadrática">Função de utilidade quadrática</a></li>
  <li><a href="#otimização-de-portfólios" id="toc-otimização-de-portfólios" class="nav-link" data-scroll-target="#otimização-de-portfólios">Otimização de portfólios</a></li>
  <li><a href="#primeiro-vamos-carregar-os-pacotes-necessários" id="toc-primeiro-vamos-carregar-os-pacotes-necessários" class="nav-link" data-scroll-target="#primeiro-vamos-carregar-os-pacotes-necessários">Primeiro vamos carregar os pacotes necessários</a></li>
  <li><a href="#ativos-selecionados" id="toc-ativos-selecionados" class="nav-link" data-scroll-target="#ativos-selecionados">Ativos selecionados</a></li>
  <li><a href="#baixando-os-preços-do-benchmark" id="toc-baixando-os-preços-do-benchmark" class="nav-link" data-scroll-target="#baixando-os-preços-do-benchmark">Baixando os preços do benchmark</a></li>
  <li><a href="#agora-vamos-converter-os-preços-diários-em-mensais" id="toc-agora-vamos-converter-os-preços-diários-em-mensais" class="nav-link" data-scroll-target="#agora-vamos-converter-os-preços-diários-em-mensais">Agora vamos converter os preços diários em mensais</a></li>
  <li><a href="#vamos-calcular-os-retornos-mensais" id="toc-vamos-calcular-os-retornos-mensais" class="nav-link" data-scroll-target="#vamos-calcular-os-retornos-mensais">Vamos calcular os retornos mensais</a></li>
  <li><a href="#otimização-da-carteira" id="toc-otimização-da-carteira" class="nav-link" data-scroll-target="#otimização-da-carteira">Otimização da carteira</a></li>
  <li><a href="#resultados-da-otimização" id="toc-resultados-da-otimização" class="nav-link" data-scroll-target="#resultados-da-otimização">Resultados da otimização</a></li>
  <li><a href="#extraindo-os-pesos-dos-ativos" id="toc-extraindo-os-pesos-dos-ativos" class="nav-link" data-scroll-target="#extraindo-os-pesos-dos-ativos">Extraindo os pesos dos ativos</a></li>
  <li><a href="#plotando-com-o-portfolioanalytics" id="toc-plotando-com-o-portfolioanalytics" class="nav-link" data-scroll-target="#plotando-com-o-portfolioanalytics">plotando com o portfolioAnalytics</a></li>
  <li><a href="#plotando-com-ggplo2" id="toc-plotando-com-ggplo2" class="nav-link" data-scroll-target="#plotando-com-ggplo2">Plotando com ggplo2</a></li>
  <li><a href="#realizando-otimização-da-função-de-utilidade-com-o-portfolioanalytics" id="toc-realizando-otimização-da-função-de-utilidade-com-o-portfolioanalytics" class="nav-link" data-scroll-target="#realizando-otimização-da-função-de-utilidade-com-o-portfolioanalytics">Realizando otimização da função de utilidade com o PortfolioAnalytics</a></li>
  <li><a href="#pesos" id="toc-pesos" class="nav-link" data-scroll-target="#pesos">Pesos</a></li>
  <li><a href="#entendendo-a-especificação-do-portfólio" id="toc-entendendo-a-especificação-do-portfólio" class="nav-link" data-scroll-target="#entendendo-a-especificação-do-portfólio">Entendendo a especificação do portfólio</a></li>
  <li><a href="#passo-a-passo-da-otimização-de-portfólios" id="toc-passo-a-passo-da-otimização-de-portfólios" class="nav-link" data-scroll-target="#passo-a-passo-da-otimização-de-portfólios">Passo a passo da otimização de portfólios</a></li>
  <li><a href="#criando-um-objeto-para-as-especificações-do-portfólio" id="toc-criando-um-objeto-para-as-especificações-do-portfólio" class="nav-link" data-scroll-target="#criando-um-objeto-para-as-especificações-do-portfólio">Criando um objeto para as especificações do portfólio</a></li>
  <li><a href="#adicionando-restrições-ao-objeto-de-portfólio" id="toc-adicionando-restrições-ao-objeto-de-portfólio" class="nav-link" data-scroll-target="#adicionando-restrições-ao-objeto-de-portfólio">Adicionando restrições ao objeto de portfólio</a></li>
  <li><a href="#adicionando-a-função-objetivo-ao-objeto-de-portfólio" id="toc-adicionando-a-função-objetivo-ao-objeto-de-portfólio" class="nav-link" data-scroll-target="#adicionando-a-função-objetivo-ao-objeto-de-portfólio">Adicionando a função objetivo ao objeto de portfólio</a></li>
  <li><a href="#resolvendo-o-problema-de-otimização" id="toc-resolvendo-o-problema-de-otimização" class="nav-link" data-scroll-target="#resolvendo-o-problema-de-otimização">Resolvendo o problema de otimização</a></li>
  <li><a href="#otimizando-a-carteira-com-rebalanceamento" id="toc-otimizando-a-carteira-com-rebalanceamento" class="nav-link" data-scroll-target="#otimizando-a-carteira-com-rebalanceamento">Otimizando a carteira com rebalanceamento</a></li>
  <li><a href="#otimização" id="toc-otimização" class="nav-link" data-scroll-target="#otimização">Otimização</a></li>
  <li><a href="#analise-dos-resultados" id="toc-analise-dos-resultados" class="nav-link" data-scroll-target="#analise-dos-resultados">Analise dos resultados</a></li>
  <li><a href="#plotando-os-pesos-ao-longo-do-tempo-com-ggplot2" id="toc-plotando-os-pesos-ao-longo-do-tempo-com-ggplot2" class="nav-link" data-scroll-target="#plotando-os-pesos-ao-longo-do-tempo-com-ggplot2">Plotando os pesos ao longo do tempo com ggplot2</a></li>
  <li><a href="#plotando-o-retorno-do-portfólio-ao-longo-do-tempo" id="toc-plotando-o-retorno-do-portfólio-ao-longo-do-tempo" class="nav-link" data-scroll-target="#plotando-o-retorno-do-portfólio-ao-longo-do-tempo">Plotando o retorno do portfólio ao longo do tempo</a></li>
  <li><a href="#bonus-plotando-a-fronteira-eficiente" id="toc-bonus-plotando-a-fronteira-eficiente" class="nav-link" data-scroll-target="#bonus-plotando-a-fronteira-eficiente">Bonus: Plotando a fronteira eficiente</a></li>
  <li><a href="#dashboards-interativos-com-quarto" id="toc-dashboards-interativos-com-quarto" class="nav-link" data-scroll-target="#dashboards-interativos-com-quarto">Dashboards interativos com QUARTO</a></li>
  <li><a href="#exercício" id="toc-exercício" class="nav-link" data-scroll-target="#exercício">Exercício</a></li>
  <li><a href="#dica-use-o-arquivo-das-aulas-anteriores-como-referência-para-criar-o-seu-dashboard" id="toc-dica-use-o-arquivo-das-aulas-anteriores-como-referência-para-criar-o-seu-dashboard" class="nav-link" data-scroll-target="#dica-use-o-arquivo-das-aulas-anteriores-como-referência-para-criar-o-seu-dashboard">Dica: Use o arquivo das aulas anteriores como referência para criar o seu dashboard</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Aula 2 - Análise e otimização de carteiras</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Professor: </div>
    <div class="quarto-title-meta-contents">
             <p>Marcus Ramalho </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="relembrando-alguns-conceitos-sobre-risco" class="level2">
<h2 class="anchored" data-anchor-id="relembrando-alguns-conceitos-sobre-risco">Relembrando alguns conceitos sobre risco</h2>
<p><strong>Risco</strong>: Probabilidade de um resultado adverso em relação ao esperado.</p>
<p><img src="images/paste-2.png" class="img-fluid" width="718"></p>
</section>
<section id="tipos-de-risco" class="level2">
<h2 class="anchored" data-anchor-id="tipos-de-risco">Tipos de risco</h2>
<ul>
<li><strong>Risco conhecido</strong>: Distribuição de probabilidade do evento é conhecida (ex: falha de motor).</li>
<li><strong>Incerteza</strong>: Distribuição de probabilidade desconhecida ou imprevisível (ex: crise econômica).</li>
</ul>
</section>
<section id="atitudes-frente-ao-risco" class="level2">
<h2 class="anchored" data-anchor-id="atitudes-frente-ao-risco">Atitudes frente ao risco</h2>
<ul>
<li><strong>Aversão</strong>: Prefere menor risco para mesmo retorno.</li>
<li><strong>Indiferença</strong>: Não se importa com o risco.</li>
<li><strong>Propensão</strong>: Aceita maior risco por potencial de maior retorno.</li>
</ul>
<p><img src="images/paste-3.png" class="img-fluid" width="723"></p>
<p>O participante de uma apólice de seguros têm que predisposição frente ao risco?</p>
<p>E a companhia de seguros?</p>
</section>
<section id="mensuração-do-risco" class="level2">
<h2 class="anchored" data-anchor-id="mensuração-do-risco">Mensuração do Risco</h2>
<ul>
<li><strong>Desvio padrão (σ)</strong>: Mede a dispersão dos resultados em torno da média.</li>
<li><strong>Coeficiente de variação (CV)</strong>: Mede o risco por unidade de retorno (σ / retorno médio).</li>
</ul>
</section>
<section id="risco-de-carteira" class="level2">
<h2 class="anchored" data-anchor-id="risco-de-carteira">Risco de Carteira</h2>
<ul>
<li><strong>Covariância</strong>: Mede a relação entre os retornos de dois ativos.</li>
<li><strong>Diversificação</strong>: Reduz o risco total da carteira ao combinar ativos com diferentes riscos (Markowitz, 1952) - “Não colocar todos os ovos na mesma cesta”.</li>
</ul>
</section>
<section id="risco-individual-vs.-sistêmico" class="level2">
<h2 class="anchored" data-anchor-id="risco-individual-vs.-sistêmico">Risco individual vs.&nbsp;sistêmico</h2>
<ul>
<li><strong>Individual</strong>: Específico de cada ativo.</li>
<li><strong>Sistêmico</strong>: Afeta todo o mercado.</li>
</ul>
</section>
<section id="índice-sharpe-is" class="level2">
<h2 class="anchored" data-anchor-id="índice-sharpe-is">Índice Sharpe (IS)</h2>
<ul>
<li><strong>Definição</strong>: Mede o retorno adicional por unidade de risco em relação à taxa livre de risco.</li>
<li><strong>Fórmula</strong>: IS = (Retorno médio do portfólio - Taxa livre de risco) / Desvio padrão do excesso de retorno.</li>
<li><strong>interpretação</strong>: IS &gt; 1: Retorno adicional por unidade de risco; IS &lt; 1: Retorno insuficiente por unidade de risco. Quantos mais alto o índice, melhor.</li>
</ul>
</section>
<section id="beta-β" class="level2">
<h2 class="anchored" data-anchor-id="beta-β">Beta (β)</h2>
<ul>
<li><strong>Definição</strong>: Mede a sensibilidade do retorno de um ativo em relação ao retorno do mercado.</li>
<li><strong>Fórmula</strong>: β = Cov(Ri, Rm) / Var(Rm).</li>
<li><strong>Interpretação</strong>: β &gt; 1: Ativo mais volátil que o mercado; β &lt; 1: Ativo menos volátil que o mercado.</li>
<li><strong>Exemplo</strong>: Se β = 1, o ativo se move na mesma direção que o mercado.</li>
</ul>
</section>
<section id="alfa-α" class="level2">
<h2 class="anchored" data-anchor-id="alfa-α">Alfa (α)</h2>
<ul>
<li><strong>Definição</strong>: Mede o retorno adicional de um ativo em relação ao retorno esperado com base no risco.</li>
<li><strong>Fórmula</strong>: α = Retorno do ativo - (Taxa livre de risco + β * (Retorno do mercado - Taxa livre de risco)).</li>
<li><strong>Interpretação</strong>: α &gt; 0: Ativo superou o retorno esperado; α &lt; 0: Ativo ficou aquém do retorno esperado.</li>
<li><strong>Exemplo</strong>: Se α = 0, o ativo teve o retorno esperado com base no risco.</li>
<li><strong>Observação</strong>: O alfa é uma medida de desempenho ajustada ao risco.</li>
</ul>
</section>
<section id="função-de-utilidade-quadrática" class="level2">
<h2 class="anchored" data-anchor-id="função-de-utilidade-quadrática">Função de utilidade quadrática</h2>
<p>A função de utilidade quadrática é usada na otimização de portfólios para encontrar a alocação de ativos que maximiza o retorno esperado e minimiza o risco. A função de utilidade quadrática é dada por:</p>
<p><span class="math inline">\(U = \mu^T w - \lambda \sigma^2\)</span></p>
<p>onde:</p>
<ul>
<li><span class="math inline">\(U\)</span> é a função de utilidade</li>
<li><span class="math inline">\(\mu^T\)</span> é o vetor de retornos esperados</li>
<li><span class="math inline">\(w\)</span> é o vetor de pesos dos ativos</li>
<li><span class="math inline">\(\lambda\)</span> é o fator de aversão ao risco</li>
</ul>
<p>generalizando para o caso de <span class="math inline">\(n\)</span> ativos, a função de utilidade quadrática é dada por:</p>
<p><span class="math inline">\(U = \mu^T w - \lambda w^T \Sigma w\)</span></p>
<p>onde:</p>
<ul>
<li><span class="math inline">\(\Sigma w\)</span> é a matriz de covariância dos retornos dos ativos</li>
<li><span class="math inline">\(w^T\)</span> é o vetor transposto de pesos dos ativos</li>
<li><span class="math inline">\(w\)</span> é o vetor de pesos dos ativos</li>
<li><span class="math inline">\(\lambda\)</span> é o fator de aversão ao risco</li>
<li><span class="math inline">\(\mu\)</span> é o vetor de retornos esperados</li>
<li><span class="math inline">\(U\)</span> é a função de utilidade</li>
</ul>
</section>
<section id="otimização-de-portfólios" class="level2">
<h2 class="anchored" data-anchor-id="otimização-de-portfólios">Otimização de portfólios</h2>
<p>A otimização de portfólios é um problema de maximização da função de utilidade quadrática sujeita a restrições, como a soma dos pesos dos ativos deve ser igual a 1 e os pesos dos ativos devem ser maiores ou iguais a zero.</p>
</section>
<section id="primeiro-vamos-carregar-os-pacotes-necessários" class="level2">
<h2 class="anchored" data-anchor-id="primeiro-vamos-carregar-os-pacotes-necessários">Primeiro vamos carregar os pacotes necessários</h2>
</section>
<section id="ativos-selecionados" class="level2">
<h2 class="anchored" data-anchor-id="ativos-selecionados">Ativos selecionados</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ativos selecionados</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VALE3.SA"</span>,<span class="st">"PETR4.SA"</span>,<span class="st">"CMIG4.SA"</span>,<span class="st">"RADL3.SA"</span>,<span class="st">"ITUB4.SA"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>prices <span class="ot">&lt;-</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getSymbols</span>(tickers, </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">src =</span> <span class="st">'yahoo'</span>, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">from =</span> <span class="st">"2019-05-30"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">"2024-05-30"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">auto.assign =</span> <span class="cn">TRUE</span>, <span class="co">#obs auto asign carrega os resultados para o ambiente</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">warnings =</span> <span class="cn">FALSE</span>,) <span class="sc">%&gt;%</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">Ad</span>(<span class="fu">get</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(merge) <span class="sc">%&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">colnames&lt;-</span><span class="st">`</span>(tickers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="baixando-os-preços-do-benchmark" class="level2">
<h2 class="anchored" data-anchor-id="baixando-os-preços-do-benchmark">Baixando os preços do benchmark</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Baixando os preços do IBOV</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ibov <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"^BVSP"</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">src =</span> <span class="st">'yahoo'</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">from =</span> <span class="st">"2019-05-30"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">to =</span> <span class="st">"2024-05-30"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">auto.assign =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">warnings =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">Ad</span>(<span class="fu">get</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(merge) <span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">colnames&lt;-</span><span class="st">`</span>(<span class="st">"IBOV"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ibov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            IBOV
2019-05-30 97457
2019-05-31 97030
2019-06-03 97020
2019-06-04 97380
2019-06-05 95999
2019-06-06 97205</code></pre>
</div>
</div>
</section>
<section id="agora-vamos-converter-os-preços-diários-em-mensais" class="level2">
<h2 class="anchored" data-anchor-id="agora-vamos-converter-os-preços-diários-em-mensais">Agora vamos converter os preços diários em mensais</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>prices_monthly <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(prices, <span class="at">indexAt =</span> <span class="st">"lastof"</span>, <span class="at">OHLC =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prices_monthly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           VALE3.SA  PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA
2019-05-31 30.86573  8.593932 4.256697 12.65753 28.16351
2019-06-30 32.64209  9.219558 4.282653 13.90627 29.18991
2019-07-31 31.37597  8.772201 4.077893 15.16898 28.04227
2019-08-31 28.70514  8.644517 4.256697 16.81909 27.53359
2019-09-30 30.07835  9.339466 4.132688 17.53679 28.43042
2019-10-31 29.73190 10.302230 3.936579 20.13409 29.41695</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ibov_monthly <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(ibov, <span class="at">indexAt =</span> <span class="st">"lastof"</span>, <span class="at">OHLC =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ibov_monthly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             IBOV
2019-05-31  97030
2019-06-30 100967
2019-07-31 101812
2019-08-31 101135
2019-09-30 104745
2019-10-31 107220</code></pre>
</div>
</div>
</section>
<section id="vamos-calcular-os-retornos-mensais" class="level2">
<h2 class="anchored" data-anchor-id="vamos-calcular-os-retornos-mensais">Vamos calcular os retornos mensais</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>asset_returns_xts <span class="ot">&lt;-</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a> PerformanceAnalytics<span class="sc">::</span><span class="fu">Return.calculate</span>(prices_monthly, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discrete"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>ibov_returns_xts <span class="ot">&lt;-</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  PerformanceAnalytics<span class="sc">::</span><span class="fu">Return.calculate</span>(ibov_monthly, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discrete"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asset_returns_xts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              VALE3.SA    PETR4.SA     CMIG4.SA   RADL3.SA    ITUB4.SA
2019-06-30  0.05755125  0.07279853  0.006097609 0.09865537  0.03644424
2019-07-31 -0.03878816 -0.04852263 -0.047811393 0.09080148 -0.03931640
2019-08-31 -0.08512349 -0.01455549  0.043847131 0.10878217 -0.01813957
2019-09-30  0.04783858  0.08039190 -0.029132712 0.04267203  0.03257206
2019-10-31 -0.01151822  0.10308553 -0.047453263 0.14810561  0.03469968
2019-11-30  0.05889835 -0.03443176 -0.043955720 0.02718191 -0.03907229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ibov_returns_xts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   IBOV
2019-06-30  0.040575080
2019-07-31  0.008369071
2019-08-31 -0.006649511
2019-09-30  0.035694863
2019-10-31  0.023628813
2019-11-30  0.009447864</code></pre>
</div>
</div>
</section>
<section id="otimização-da-carteira" class="level2">
<h2 class="anchored" data-anchor-id="otimização-da-carteira">Otimização da carteira</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando o objeto de otimização</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"weight_sum"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_sum =</span> <span class="fl">0.99</span>, <span class="at">max_sum =</span> <span class="fl">1.01</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrição de peso mínimo e máximo para cada ativo</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Neste caso, o peso mínimo é 0 e o peso máximo é 1</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"long_only"</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é minimizar o desvio padrão da carteira</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"return"</span>, <span class="at">name =</span> <span class="st">"mean"</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve o problema de otimização</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>opt_portf <span class="ot">&lt;-</span> <span class="fu">optimize.portfolio</span>(asset_returns_xts,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>                                portf,</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>                                <span class="at">optimize_method =</span> <span class="st">"ROI"</span>,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>                                <span class="at">maxSR =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>                                <span class="at">trace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="resultados-da-otimização" class="level2">
<h2 class="anchored" data-anchor-id="resultados-da-otimização">Resultados da otimização</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>opt_portf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>***********************************
PortfolioAnalytics Optimization
***********************************

Call:
optimize.portfolio(R = asset_returns_xts, portfolio = portf, 
    optimize_method = "ROI", trace = TRUE, maxSR = TRUE)

Optimal Weights:
VALE3.SA PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA 
  0.2608   0.3838   0.0000   0.3511   0.0000 

Objective Measure:
 StdDev 
0.06709 


   mean 
0.02114 </code></pre>
</div>
</div>
</section>
<section id="extraindo-os-pesos-dos-ativos" class="level2">
<h2 class="anchored" data-anchor-id="extraindo-os-pesos-dos-ativos">Extraindo os pesos dos ativos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extraindo os pesos para um data frame</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">extractWeights</span>(opt_portf)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando os nomes dos ativos sem colocá-los no índice</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tickers =</span> <span class="fu">colnames</span>(asset_returns_xts), weights, <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   tickers       weights
1 VALE3.SA  2.608392e-01
2 PETR4.SA  3.837557e-01
3 CMIG4.SA -1.387779e-17
4 RADL3.SA  3.511171e-01
5 ITUB4.SA  2.411089e-18</code></pre>
</div>
</div>
</section>
<section id="plotando-com-o-portfolioanalytics" class="level2">
<h2 class="anchored" data-anchor-id="plotando-com-o-portfolioanalytics">plotando com o portfolioAnalytics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Weights</span>(opt_portf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="otimização_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotando-com-ggplo2" class="level2">
<h2 class="anchored" data-anchor-id="plotando-com-ggplo2">Plotando com ggplo2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weights, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(tickers, weights), <span class="at">y =</span> weights, <span class="at">fill =</span> tickers)) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribuição dos Pesos dos Ativos"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> <span class="st">"Ativos"</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> <span class="st">"Pesos"</span>) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="otimização_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="realizando-otimização-da-função-de-utilidade-com-o-portfolioanalytics" class="level2">
<h2 class="anchored" data-anchor-id="realizando-otimização-da-função-de-utilidade-com-o-portfolioanalytics">Realizando otimização da função de utilidade com o PortfolioAnalytics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#criar o objeto de otimização</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"full_investment"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrição de peso mínimo e máximo para cada ativo (0-1)</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"long_only"</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é maximizar o retorno esperado</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"return"</span>, <span class="at">name =</span> <span class="st">"mean"</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é minimizar a variância da carteira</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"var"</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"quadratic_utility"</span>, <span class="at">risk_aversion =</span> <span class="dv">10</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve o problema de otimização</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>opt_portf <span class="ot">&lt;-</span> <span class="fu">optimize.portfolio</span>(asset_returns_xts, portf, <span class="at">optimize_method =</span> <span class="st">"ROI"</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraindo os pesos dos ativos</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="fu">extractWeights</span>(opt_portf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     VALE3.SA      PETR4.SA      CMIG4.SA      RADL3.SA      ITUB4.SA 
 3.291017e-01  1.614216e-01  3.206608e-02  4.774106e-01 -1.387779e-17 </code></pre>
</div>
</div>
</section>
<section id="pesos" class="level2">
<h2 class="anchored" data-anchor-id="pesos">Pesos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractWeights</span>(opt_portf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     VALE3.SA      PETR4.SA      CMIG4.SA      RADL3.SA      ITUB4.SA 
 3.291017e-01  1.614216e-01  3.206608e-02  4.774106e-01 -1.387779e-17 </code></pre>
</div>
</div>
</section>
<section id="entendendo-a-especificação-do-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="entendendo-a-especificação-do-portfólio">Entendendo a especificação do portfólio</h2>
<p>O objeto de portfólio é uma lista que contém as seguintes informações:</p>
<ul>
<li><strong>assets</strong>: vetor de nomes dos ativos</li>
<li><strong>constraints</strong>: lista de restrições
<ul>
<li><strong>weight_sum</strong>: restrição de que a soma dos pesos dos ativos deve ser igual a um valor específico</li>
<li><strong>full_investment</strong>: restrição de que a soma dos pesos dos ativos deve ser igual a 1</li>
<li><strong>dollar_neutral</strong>: restrição de que a soma dos pesos dos ativos deve ser igual a zero</li>
<li><strong>box</strong>: restrição de que os pesos dos ativos devem estar dentro de um intervalo específico</li>
<li><strong>long_only</strong>: restrição de que os pesos dos ativos devem ser maiores ou iguais a zero e menores ou iguais a um (caso especial da restrição box)</li>
<li><strong>group</strong>: restrição de que os pesos dos ativos de um grupo específico devem ser iguais</li>
<li><strong>turnover</strong>: restrição de que o turnover da carteira deve ser menor ou igual a um valor específico a partir de uma carteira inicial</li>
<li><strong>diversification</strong>: Especifica um valor de diversificação para a carteira</li>
<li><strong>position_limit</strong>: Permite ao usuário definir o número máximo de posições (ativos com pesos não nulos) e o número máximo de posições compradas e vendidas.</li>
<li><strong>return</strong>: Especifica o retorno médio esperado da carteira</li>
<li><strong>factor_exposure</strong>: Especifica a exposição da carteira a fatores de risco</li>
<li><strong>leverage_exposure</strong>: Especifica a alavancagem maxima da carteira onde a alavancagem é definida como a soma dos pesos absolutos dos ativos</li>
</ul></li>
<li><strong>objectives</strong>:
<ul>
<li><strong>type</strong>: ‘return’,‘risk’, ‘risk_budget’, ‘quadratic_utility’, or ’weight_concentration</li>
</ul></li>
</ul>
</section>
<section id="passo-a-passo-da-otimização-de-portfólios" class="level2">
<h2 class="anchored" data-anchor-id="passo-a-passo-da-otimização-de-portfólios">Passo a passo da otimização de portfólios</h2>
<ol type="1">
<li>Carregar os preços dos ativos e do benchmark</li>
<li>Converter os preços diários em preços mensais</li>
<li>Calcular os retornos mensais dos ativos e do benchmark</li>
<li><strong>Criar o objeto de portfólio</strong></li>
<li><strong>Adicionar restrições ao objeto de portfólio</strong></li>
<li><strong>Adicionar a função objetivo ao objeto de portfólio</strong></li>
<li><strong>Resolver o problema de otimização</strong></li>
<li><strong>Exibir os resultados da otimização</strong></li>
<li><strong>Exibir os pesos dos ativos na carteira otimizada</strong></li>
<li><strong>Plotar a distribuição dos pesos dos ativos na carteira otimizada</strong></li>
</ol>
</section>
<section id="criando-um-objeto-para-as-especificações-do-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="criando-um-objeto-para-as-especificações-do-portfólio">Criando um objeto para as especificações do portfólio</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando o objeto de portfólio, aqui estamos apenas especificando os ativos que serão utilizados na otimização</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(port_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "portfolio.spec" "portfolio"     </code></pre>
</div>
</div>
</section>
<section id="adicionando-restrições-ao-objeto-de-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="adicionando-restrições-ao-objeto-de-portfólio">Adicionando restrições ao objeto de portfólio</h2>
<p>As restrições são condições que devem ser satisfeitas durante a otimização da carteira. Algumas restrições comuns são relacionadas ao peso dos ativos e ao retorno esperado da carteira.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>port_spec  <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_spec, <span class="at">type =</span> <span class="st">"weight_sum"</span>, <span class="at">min_sum =</span> <span class="dv">1</span>, <span class="at">max_sum =</span> <span class="dv">1</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># adicionnando uma restrição de caixas para os pesos dos ativos</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_spec, <span class="at">type =</span> <span class="st">"box"</span>, <span class="at">min =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">max =</span> <span class="fl">0.4</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>port_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**************************************************
PortfolioAnalytics Portfolio Specification 
**************************************************

Call:
portfolio.spec(assets = colnames(asset_returns_xts))

Number of assets: 5 
Asset Names
[1] "VALE3.SA" "PETR4.SA" "CMIG4.SA" "RADL3.SA" "ITUB4.SA"

Constraints
Enabled constraint types
        - weight_sum 
        - box </code></pre>
</div>
</div>
</section>
<section id="adicionando-a-função-objetivo-ao-objeto-de-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="adicionando-a-função-objetivo-ao-objeto-de-portfólio">Adicionando a função objetivo ao objeto de portfólio</h2>
<p>A função objetivo é a função que será otimizada durante o processo de otimização da carteira. Um objetivo comum é maximizar o retorno esperado da carteira e minimizar a volatilidade e o risco.</p>
<p>Lembre-se que o desvio padrão é a raiz quadrada da variância. E que a variância é a média dos quadrados dos desvios em relação à média. A variancia é geralmente usada para denotar o risco, quanto maior a variancia, maior o risco. Já geralmente denota a volatilidade, quanto maior o desvio padrão, maior a volatilidade. Ambas são medidas que servem como indicadores de risco.</p>
<p>No portfolioAnalytics, a função objetivo é adicionada ao objeto de portfólio usando a função <code>add.objective()</code>. Os objetivos mais usado são:</p>
<ul>
<li><strong>return</strong>: Maximizar o retorno esperado da carteira</li>
<li><strong>risk</strong>: Minimizar o risco da carteira</li>
<li><strong>risk_budget</strong>: Minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira</li>
<li><strong>quadratic_utility</strong>: Maximizar a função de utilidade quadrática da carteira</li>
<li><strong>weight_concentration</strong>: Minimizar a concentração dos pesos dos ativos na carteira</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é maximizar o retorno médio esperado da carteira</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_spec, <span class="at">type =</span> <span class="st">"return"</span>, <span class="at">name =</span> <span class="st">"mean"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é minimizar o desvio padrão da carteira</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_spec, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona um objetivo para minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_spec, <span class="at">type =</span> <span class="st">"risk_budget"</span>, <span class="at">name =</span> <span class="st">"var"</span>, <span class="at">min_prisk =</span> <span class="fl">0.05</span>, <span class="at">max_prisk =</span> <span class="fl">0.1</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(port_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**************************************************
PortfolioAnalytics Portfolio Specification 
**************************************************

Call:
portfolio.spec(assets = colnames(asset_returns_xts))

Number of assets: 5 
Asset Names
[1] "VALE3.SA" "PETR4.SA" "CMIG4.SA" "RADL3.SA" "ITUB4.SA"

Constraints
Enabled constraint types
        - weight_sum 
        - box 

Objectives:
Enabled objective names
        - mean 
        - StdDev 
        - var </code></pre>
</div>
</div>
</section>
<section id="resolvendo-o-problema-de-otimização" class="level2">
<h2 class="anchored" data-anchor-id="resolvendo-o-problema-de-otimização">Resolvendo o problema de otimização</h2>
<p>Existem duas funções principais para resolver o problema de otimização da carteira: <code>optimize.portfolio()</code> e <code>optimize.portfolio.rebalancing()</code>. A função <code>optimize.portfolio()</code> é usada para otimizar a carteira sem rebalanceamento, enquanto a função <code>optimize.portfolio.rebalancing()</code> é usada para otimizar a carteira com rebalanceamento.</p>
<p>Lembre-se que o rebalanceamento é o processo de ajustar os pesos dos ativos na carteira para manter a alocação desejada ao longo do tempo.</p>
<p>O pacote suporta diversos métodos de otimização, como:</p>
<ul>
<li><strong>DEoptim</strong>: Differential Evolution</li>
<li><strong>random</strong>: Random Portfolios</li>
<li><strong>GenSA</strong>: Generalized Simulated Annealing</li>
<li><strong>pso</strong>: Particle Swarm Optimization</li>
<li><strong>ROI</strong>: R Optimization Infrastructure</li>
</ul>
<p>O método a ser usado irá depender do problema.</p>
<p>Vamos fazer fazer uma otimização usando o método de portifolios aleatórios. Nosso objetivo é maximizar o retorno esperado da carteira e minimizar o risco onde o risco minimo é 5% e o risco maximo é 10% sujeito a restrições de peso e de grupo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># .storage &lt;&lt;- new.env()</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>rp <span class="ot">&lt;-</span> <span class="fu">random_portfolios</span>(port_spec, <span class="at">permutations =</span> <span class="dv">1000</span>, <span class="at">rp_method =</span> <span class="st">'simplex'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: executing %dopar% sequentially: no parallel backend registered</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rp &lt;- random_portfolios(port_spec, permutations = 1000, rp_method = 'sample')</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rp &lt;- random_portfolios(port_spec, permutations = 1000, rp_method = 'grid') </span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      VALE3.SA  PETR4.SA  CMIG4.SA  RADL3.SA  ITUB4.SA
[1,] 0.3224445 0.2402095 0.1655588 0.1200365 0.1517508
[2,] 0.3110452 0.2437957 0.1778512 0.1055166 0.1617914
[3,] 0.2315571 0.1019185 0.1904136 0.3282470 0.1478639
[4,] 0.3011285 0.1867509 0.2018843 0.1481562 0.1620801
[5,] 0.2624004 0.1637672 0.2152460 0.2017702 0.1568162
[6,] 0.2027899 0.1553114 0.3381339 0.2026653 0.1010994</code></pre>
</div>
</div>
<p>Simplex: Distribui pesos aleatoriamente em um espaço triangular, garantindo que a soma seja sempre 1. Sample: Seleciona pesos aleatórios de uma distribuição de probabilidade específica. Grid: Gera pesos em pontos pré-definidos de uma grade regular.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>opt  <span class="ot">&lt;-</span>  <span class="fu">optimize.portfolio</span>(<span class="at">R =</span> asset_returns_xts, port_spec, <span class="at">rp =</span> rp, <span class="at">optimize_method =</span> <span class="st">"random"</span>, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Leverage constraint min_sum and max_sum are restrictive, 
              consider relaxing. e.g. 'full_investment' constraint should be min_sum=0.99 and max_sum=1.01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(opt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>***********************************
PortfolioAnalytics Optimization
***********************************

Call:
optimize.portfolio(R = asset_returns_xts, portfolio = port_spec, 
    optimize_method = "random", trace = TRUE, rp = rp)

Optimal Weights:
VALE3.SA PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA 
  0.3039   0.1009   0.1000   0.3927   0.1024 

Objective Measures:
   mean 
0.01596 


StdDev 
0.0602 

contribution :
VALE3.SA PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA 
0.017699 0.007228 0.006641 0.021894 0.006735 

pct_contrib_StdDev :
VALE3.SA PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA 
  0.2940   0.1201   0.1103   0.3637   0.1119 </code></pre>
</div>
</div>
</section>
<section id="otimizando-a-carteira-com-rebalanceamento" class="level2">
<h2 class="anchored" data-anchor-id="otimizando-a-carteira-com-rebalanceamento">Otimizando a carteira com rebalanceamento</h2>
<p>A função <code>optimize.portfolio.rebalancing()</code> é usada para otimizar a carteira com rebalanceamento. O rebalanceamento é o processo de ajustar os pesos dos ativos na carteira para manter a alocação desejada ao longo do tempo. O rebalanceamento é importante para garantir que a carteira permaneça alinhada com os objetivos de investimento (restrições e objetivos) ao longo do tempo.</p>
<p><code>optimize.portfolio.rebalancing()</code> suporta otimização de carteiras com rebalanceamento em diferentes janelas de tempo. O backtest é o processo de testar uma estratégia de investimento em dados históricos para avaliar seu desempenho.</p>
<p>OBS: Dependendo do método de otimização, o processo pode ser demorado.</p>
<p>Exemplo de otimização com rebalanceamento:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar o objeto de portfólio</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar restrições - full investment com soma de pesos igual a 1</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_specr, <span class="at">type =</span> <span class="st">"long_only"</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># restrição para a soma dos pesos</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_specr, <span class="at">type =</span> <span class="st">"weight_sum"</span>, <span class="at">min_sum =</span> <span class="fl">0.99</span>, <span class="at">max_sum =</span> <span class="fl">1.01</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar a função objetivo - maximizar o retorno esperado</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_specr, <span class="at">type =</span> <span class="st">"return"</span>, <span class="at">name =</span> <span class="st">"mean"</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar a função objetivo - minimizar o risco</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_specr, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar a função objetivo - minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_specr, <span class="at">type =</span> <span class="st">"risk_budget"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>, <span class="at">min_prisk =</span> <span class="fl">0.05</span>, <span class="at">max_prisk =</span> <span class="fl">0.1</span>)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>rp <span class="ot">&lt;-</span> <span class="fu">random_portfolios</span>(port_specr, <span class="at">permutations =</span> <span class="dv">50</span>, <span class="at">rp_method =</span> <span class="st">'simplex'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="otimização" class="level2">
<h2 class="anchored" data-anchor-id="otimização">Otimização</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Otimização com rebalanceamento mensal</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>opt_rebal <span class="ot">&lt;-</span> <span class="fu">optimize.portfolio.rebalancing</span>(<span class="at">R =</span> asset_returns_xts, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">portfolio =</span> port_specr, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">optimize_method =</span> <span class="st">"random"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rp =</span> rp,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">trace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">search_size =</span> <span class="dv">1000</span>,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rebalance_on =</span> <span class="st">"months"</span>,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">training_period =</span> <span class="dv">12</span>,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rolling_window =</span> <span class="dv">12</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(opt_rebal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**************************************************
PortfolioAnalytics Optimization with Rebalancing
**************************************************

Call:
optimize.portfolio.rebalancing(R = asset_returns_xts, portfolio = port_specr, 
    optimize_method = "random", search_size = 1000, trace = TRUE, 
    rp = rp, rebalance_on = "months", training_period = 12, rolling_window = 12)

Number of rebalancing dates:  49 
First rebalance date:
[1] "2020-05-31"
Last rebalance date:
[1] "2024-05-31"

Annualized Portfolio Rebalancing Return:
[1] 0.2548541

Annualized Portfolio Standard Deviation:
[1] 0.203243</code></pre>
</div>
</div>
</section>
<section id="analise-dos-resultados" class="level2">
<h2 class="anchored" data-anchor-id="analise-dos-resultados">Analise dos resultados</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractObjectiveMeasures</span>(opt_rebal) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  mean     StdDev StdDev.contribution.VALE3.SA
2020-05-31 0.006597553 0.08007868                   0.01307995
           StdDev.contribution.PETR4.SA StdDev.contribution.CMIG4.SA
2020-05-31                   0.01011723                   0.03263592
           StdDev.contribution.RADL3.SA StdDev.contribution.ITUB4.SA
2020-05-31                   0.01457031                  0.009675268
           StdDev.pct_contrib_StdDev.VALE3.SA
2020-05-31                          0.1633387
           StdDev.pct_contrib_StdDev.PETR4.SA
2020-05-31                          0.1263411
           StdDev.pct_contrib_StdDev.CMIG4.SA
2020-05-31                          0.4075482
           StdDev.pct_contrib_StdDev.RADL3.SA
2020-05-31                            0.18195
           StdDev.pct_contrib_StdDev.ITUB4.SA
2020-05-31                           0.120822</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractWeights</span>(opt_rebal) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            VALE3.SA  PETR4.SA  CMIG4.SA  RADL3.SA  ITUB4.SA
2020-05-31 0.2768987 0.0631134 0.2757865 0.2572021 0.1269994
2020-06-30 0.2768987 0.0631134 0.2757865 0.2572021 0.1269994
2020-07-31 0.2768987 0.0631134 0.2757865 0.2572021 0.1269994
2020-08-31 0.2768987 0.0631134 0.2757865 0.2572021 0.1269994
2020-09-30 0.2768987 0.0631134 0.2757865 0.2572021 0.1269994
2020-10-31 0.2768987 0.0631134 0.2757865 0.2572021 0.1269994</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Weights</span>(opt) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="otimização_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Weights</span>(opt_rebal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="otimização_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotando-os-pesos-ao-longo-do-tempo-com-ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="plotando-os-pesos-ao-longo-do-tempo-com-ggplot2">Plotando os pesos ao longo do tempo com ggplot2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraindo os pesos dos ativos ao longo do tempo</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>weights_xts <span class="ot">&lt;-</span> <span class="fu">extractWeights</span>(opt_rebal)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertendo os pesos para um data frame</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>weights_df <span class="ot">&lt;-</span> weights_xts <span class="sc">%&gt;%</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">tk_tbl</span>(<span class="at">preserve_index =</span> <span class="cn">TRUE</span>, <span class="at">rename_index =</span> <span class="st">"Date"</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Colocando o data frame em formato longo</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>weights_long_df <span class="ot">&lt;-</span> weights_df <span class="sc">%&gt;%</span> </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Date, <span class="at">names_to =</span> <span class="st">"Asset"</span>, <span class="at">values_to =</span> <span class="st">"Weight"</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(<span class="fu">ggplot</span>(weights_long_df) <span class="sc">+</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Weight, <span class="at">colour =</span> Asset) <span class="sc">+</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span> ) <span class="sc">+</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hue</span>(<span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Data"</span>,</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Peso"</span>,</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Peso dos ativos rebalanceados ao longo do tempo"</span>,</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"Ativos"</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>L,</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d1d8097eaa22bf7fb804" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d1d8097eaa22bf7fb804">{"x":{"data":[{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.29493556266012094,0.29198749322052053,0.28905875528920838,0.28613525673067236,0.28320290540940207,0.28024760918988639,0.2772552759366152,0.27421181351407603,0.27110312978675866,0.26791513261915201,0.26463282454265857,0.2611601033961774,0.2574849536477391,0.25367204874972532,0.24978606215451835,0.24589166731449832,0.24205353768204763,0.2383363467095479,0.2348047678493814,0.23152347455392838,0.22850532726349157,0.22483367064228418,0.22035451090937322,0.21533705216862323,0.21005049852390145,0.20476405407907433,0.1997469229380093,0.19526830920457078,0.19159741698262617,0.18900345037604194,0.18771020846301747,0.18738203420179128,0.18781275460365696,0.18890548652702618,0.19056334683031051,0.1926894523719225,0.19518692001027363,0.19795886660377571,0.20090840901084001,0.2039386640898796,0.20727446900766,0.21241756562876604,0.21919070092855328,0.22714438434132153,0.23582912530136704,0.24479543324298697,0.25359381760047683,0.26177478780813751,0.26888885330026435,0.27448652351115466,0.27848354487908922,0.28198906071496971,0.28515725289821164,0.28802930285513245,0.29064639201204928,0.29304970179528084,0.29528041363114405,0.29737970894595644,0.29938876916603518,0.30134877571769875,0.30320762631524922,0.30479628065416337,0.30612794536540183,0.30722221690564161,0.30809869173155879,0.30877696629982954,0.30927663706713021,0.3096173004901373,0.30981855302552719,0.3098999911299759,0.309869558202999,0.30971458232378762,0.30942948526655289,0.30900880244232082,0.30844706926211712,0.30773882113696766,0.30687859347789836,0.30586092169593537,0.30468034120210408,0.30333138740743071],"text":["Date: 18413.00<br />Weight: 0.29493556<br />Asset: CMIG4.SA","Date: 18431.49<br />Weight: 0.29198749<br />Asset: CMIG4.SA","Date: 18449.99<br />Weight: 0.28905876<br />Asset: CMIG4.SA","Date: 18468.48<br />Weight: 0.28613526<br />Asset: CMIG4.SA","Date: 18486.97<br />Weight: 0.28320291<br />Asset: CMIG4.SA","Date: 18505.47<br />Weight: 0.28024761<br />Asset: CMIG4.SA","Date: 18523.96<br />Weight: 0.27725528<br />Asset: CMIG4.SA","Date: 18542.46<br />Weight: 0.27421181<br />Asset: CMIG4.SA","Date: 18560.95<br />Weight: 0.27110313<br />Asset: CMIG4.SA","Date: 18579.44<br />Weight: 0.26791513<br />Asset: CMIG4.SA","Date: 18597.94<br />Weight: 0.26463282<br />Asset: CMIG4.SA","Date: 18616.43<br />Weight: 0.26116010<br />Asset: CMIG4.SA","Date: 18634.92<br />Weight: 0.25748495<br />Asset: CMIG4.SA","Date: 18653.42<br />Weight: 0.25367205<br />Asset: CMIG4.SA","Date: 18671.91<br />Weight: 0.24978606<br />Asset: CMIG4.SA","Date: 18690.41<br />Weight: 0.24589167<br />Asset: CMIG4.SA","Date: 18708.90<br />Weight: 0.24205354<br />Asset: CMIG4.SA","Date: 18727.39<br />Weight: 0.23833635<br />Asset: CMIG4.SA","Date: 18745.89<br />Weight: 0.23480477<br />Asset: CMIG4.SA","Date: 18764.38<br />Weight: 0.23152347<br />Asset: CMIG4.SA","Date: 18782.87<br />Weight: 0.22850533<br />Asset: CMIG4.SA","Date: 18801.37<br />Weight: 0.22483367<br />Asset: CMIG4.SA","Date: 18819.86<br />Weight: 0.22035451<br />Asset: CMIG4.SA","Date: 18838.35<br />Weight: 0.21533705<br />Asset: CMIG4.SA","Date: 18856.85<br />Weight: 0.21005050<br />Asset: CMIG4.SA","Date: 18875.34<br />Weight: 0.20476405<br />Asset: CMIG4.SA","Date: 18893.84<br />Weight: 0.19974692<br />Asset: CMIG4.SA","Date: 18912.33<br />Weight: 0.19526831<br />Asset: CMIG4.SA","Date: 18930.82<br />Weight: 0.19159742<br />Asset: CMIG4.SA","Date: 18949.32<br />Weight: 0.18900345<br />Asset: CMIG4.SA","Date: 18967.81<br />Weight: 0.18771021<br />Asset: CMIG4.SA","Date: 18986.30<br />Weight: 0.18738203<br />Asset: CMIG4.SA","Date: 19004.80<br />Weight: 0.18781275<br />Asset: CMIG4.SA","Date: 19023.29<br />Weight: 0.18890549<br />Asset: CMIG4.SA","Date: 19041.78<br />Weight: 0.19056335<br />Asset: CMIG4.SA","Date: 19060.28<br />Weight: 0.19268945<br />Asset: CMIG4.SA","Date: 19078.77<br />Weight: 0.19518692<br />Asset: CMIG4.SA","Date: 19097.27<br />Weight: 0.19795887<br />Asset: CMIG4.SA","Date: 19115.76<br />Weight: 0.20090841<br />Asset: CMIG4.SA","Date: 19134.25<br />Weight: 0.20393866<br />Asset: CMIG4.SA","Date: 19152.75<br />Weight: 0.20727447<br />Asset: CMIG4.SA","Date: 19171.24<br />Weight: 0.21241757<br />Asset: CMIG4.SA","Date: 19189.73<br />Weight: 0.21919070<br />Asset: CMIG4.SA","Date: 19208.23<br />Weight: 0.22714438<br />Asset: CMIG4.SA","Date: 19226.72<br />Weight: 0.23582913<br />Asset: CMIG4.SA","Date: 19245.22<br />Weight: 0.24479543<br />Asset: CMIG4.SA","Date: 19263.71<br />Weight: 0.25359382<br />Asset: CMIG4.SA","Date: 19282.20<br />Weight: 0.26177479<br />Asset: CMIG4.SA","Date: 19300.70<br />Weight: 0.26888885<br />Asset: CMIG4.SA","Date: 19319.19<br />Weight: 0.27448652<br />Asset: CMIG4.SA","Date: 19337.68<br />Weight: 0.27848354<br />Asset: CMIG4.SA","Date: 19356.18<br />Weight: 0.28198906<br />Asset: CMIG4.SA","Date: 19374.67<br />Weight: 0.28515725<br />Asset: CMIG4.SA","Date: 19393.16<br />Weight: 0.28802930<br />Asset: CMIG4.SA","Date: 19411.66<br />Weight: 0.29064639<br />Asset: CMIG4.SA","Date: 19430.15<br />Weight: 0.29304970<br />Asset: CMIG4.SA","Date: 19448.65<br />Weight: 0.29528041<br />Asset: CMIG4.SA","Date: 19467.14<br />Weight: 0.29737971<br />Asset: CMIG4.SA","Date: 19485.63<br />Weight: 0.29938877<br />Asset: CMIG4.SA","Date: 19504.13<br />Weight: 0.30134878<br />Asset: CMIG4.SA","Date: 19522.62<br />Weight: 0.30320763<br />Asset: CMIG4.SA","Date: 19541.11<br />Weight: 0.30479628<br />Asset: CMIG4.SA","Date: 19559.61<br />Weight: 0.30612795<br />Asset: CMIG4.SA","Date: 19578.10<br />Weight: 0.30722222<br />Asset: CMIG4.SA","Date: 19596.59<br />Weight: 0.30809869<br />Asset: CMIG4.SA","Date: 19615.09<br />Weight: 0.30877697<br />Asset: CMIG4.SA","Date: 19633.58<br />Weight: 0.30927664<br />Asset: CMIG4.SA","Date: 19652.08<br />Weight: 0.30961730<br />Asset: CMIG4.SA","Date: 19670.57<br />Weight: 0.30981855<br />Asset: CMIG4.SA","Date: 19689.06<br />Weight: 0.30989999<br />Asset: CMIG4.SA","Date: 19707.56<br />Weight: 0.30986956<br />Asset: CMIG4.SA","Date: 19726.05<br />Weight: 0.30971458<br />Asset: CMIG4.SA","Date: 19744.54<br />Weight: 0.30942949<br />Asset: CMIG4.SA","Date: 19763.04<br />Weight: 0.30900880<br />Asset: CMIG4.SA","Date: 19781.53<br />Weight: 0.30844707<br />Asset: CMIG4.SA","Date: 19800.03<br />Weight: 0.30773882<br />Asset: CMIG4.SA","Date: 19818.52<br />Weight: 0.30687859<br />Asset: CMIG4.SA","Date: 19837.01<br />Weight: 0.30586092<br />Asset: CMIG4.SA","Date: 19855.51<br />Weight: 0.30468034<br />Asset: CMIG4.SA","Date: 19874.00<br />Weight: 0.30333139<br />Asset: CMIG4.SA"],"type":"scatter","mode":"lines","name":"(CMIG4.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","legendgroup":"(CMIG4.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.12255972170446115,0.12354417567494858,0.12450057657255303,0.12542832726858402,0.12632683063435035,0.12719548954116119,0.12803370686032545,0.12884088546315242,0.1296164282209511,0.13035973800503056,0.13107015258752522,0.13174081312383412,0.13236971842756368,0.13296014222945088,0.13351535826023259,0.13403864025064582,0.13453326193142762,0.13500249703331479,0.13544961928704422,0.13587790242335301,0.13628911310937114,0.13665729976779187,0.13697704508351582,0.13725500947899524,0.13749785337668227,0.13771223719902911,0.13790482136848789,0.13808226630751091,0.1382512324385502,0.13841838018405808,0.13858608767681641,0.13871487917524322,0.13879922177002799,0.13884621601814329,0.1388629624765618,0.13885656170225627,0.13883411425219933,0.13880272068336361,0.13876948155272187,0.13874149741724667,0.13873081641418036,0.13876320526237199,0.13882986802446548,0.13891725440700925,0.13901181411655167,0.1390999968596412,0.1391682523428262,0.13920303027265507,0.1391907803556762,0.13911795229843799,0.13895847329503083,0.13867521914675887,0.13829971991603618,0.13786890096687518,0.13741968766328844,0.13698900536928818,0.13661377944888686,0.13633093526609702,0.13617739818493102,0.13619009356940123,0.13633779035399191,0.13649687441246294,0.13667093154400237,0.13686812117295419,0.13709660272366217,0.13736453562047024,0.13768007928772216,0.138051393149762,0.13848663663093358,0.13899396915558074,0.13957461026043641,0.14022032821902966,0.14092900168274275,0.14169858560655257,0.14252703494543584,0.1434123046543698,0.14435234968833119,0.14534512500229674,0.14638858555124376,0.14748068629014896],"text":["Date: 18413.00<br />Weight: 0.12255972<br />Asset: ITUB4.SA","Date: 18431.49<br />Weight: 0.12354418<br />Asset: ITUB4.SA","Date: 18449.99<br />Weight: 0.12450058<br />Asset: ITUB4.SA","Date: 18468.48<br />Weight: 0.12542833<br />Asset: ITUB4.SA","Date: 18486.97<br />Weight: 0.12632683<br />Asset: ITUB4.SA","Date: 18505.47<br />Weight: 0.12719549<br />Asset: ITUB4.SA","Date: 18523.96<br />Weight: 0.12803371<br />Asset: ITUB4.SA","Date: 18542.46<br />Weight: 0.12884089<br />Asset: ITUB4.SA","Date: 18560.95<br />Weight: 0.12961643<br />Asset: ITUB4.SA","Date: 18579.44<br />Weight: 0.13035974<br />Asset: ITUB4.SA","Date: 18597.94<br />Weight: 0.13107015<br />Asset: ITUB4.SA","Date: 18616.43<br />Weight: 0.13174081<br />Asset: ITUB4.SA","Date: 18634.92<br />Weight: 0.13236972<br />Asset: ITUB4.SA","Date: 18653.42<br />Weight: 0.13296014<br />Asset: ITUB4.SA","Date: 18671.91<br />Weight: 0.13351536<br />Asset: ITUB4.SA","Date: 18690.41<br />Weight: 0.13403864<br />Asset: ITUB4.SA","Date: 18708.90<br />Weight: 0.13453326<br />Asset: ITUB4.SA","Date: 18727.39<br />Weight: 0.13500250<br />Asset: ITUB4.SA","Date: 18745.89<br />Weight: 0.13544962<br />Asset: ITUB4.SA","Date: 18764.38<br />Weight: 0.13587790<br />Asset: ITUB4.SA","Date: 18782.87<br />Weight: 0.13628911<br />Asset: ITUB4.SA","Date: 18801.37<br />Weight: 0.13665730<br />Asset: ITUB4.SA","Date: 18819.86<br />Weight: 0.13697705<br />Asset: ITUB4.SA","Date: 18838.35<br />Weight: 0.13725501<br />Asset: ITUB4.SA","Date: 18856.85<br />Weight: 0.13749785<br />Asset: ITUB4.SA","Date: 18875.34<br />Weight: 0.13771224<br />Asset: ITUB4.SA","Date: 18893.84<br />Weight: 0.13790482<br />Asset: ITUB4.SA","Date: 18912.33<br />Weight: 0.13808227<br />Asset: ITUB4.SA","Date: 18930.82<br />Weight: 0.13825123<br />Asset: ITUB4.SA","Date: 18949.32<br />Weight: 0.13841838<br />Asset: ITUB4.SA","Date: 18967.81<br />Weight: 0.13858609<br />Asset: ITUB4.SA","Date: 18986.30<br />Weight: 0.13871488<br />Asset: ITUB4.SA","Date: 19004.80<br />Weight: 0.13879922<br />Asset: ITUB4.SA","Date: 19023.29<br />Weight: 0.13884622<br />Asset: ITUB4.SA","Date: 19041.78<br />Weight: 0.13886296<br />Asset: ITUB4.SA","Date: 19060.28<br />Weight: 0.13885656<br />Asset: ITUB4.SA","Date: 19078.77<br />Weight: 0.13883411<br />Asset: ITUB4.SA","Date: 19097.27<br />Weight: 0.13880272<br />Asset: ITUB4.SA","Date: 19115.76<br />Weight: 0.13876948<br />Asset: ITUB4.SA","Date: 19134.25<br />Weight: 0.13874150<br />Asset: ITUB4.SA","Date: 19152.75<br />Weight: 0.13873082<br />Asset: ITUB4.SA","Date: 19171.24<br />Weight: 0.13876321<br />Asset: ITUB4.SA","Date: 19189.73<br />Weight: 0.13882987<br />Asset: ITUB4.SA","Date: 19208.23<br />Weight: 0.13891725<br />Asset: ITUB4.SA","Date: 19226.72<br />Weight: 0.13901181<br />Asset: ITUB4.SA","Date: 19245.22<br />Weight: 0.13910000<br />Asset: ITUB4.SA","Date: 19263.71<br />Weight: 0.13916825<br />Asset: ITUB4.SA","Date: 19282.20<br />Weight: 0.13920303<br />Asset: ITUB4.SA","Date: 19300.70<br />Weight: 0.13919078<br />Asset: ITUB4.SA","Date: 19319.19<br />Weight: 0.13911795<br />Asset: ITUB4.SA","Date: 19337.68<br />Weight: 0.13895847<br />Asset: ITUB4.SA","Date: 19356.18<br />Weight: 0.13867522<br />Asset: ITUB4.SA","Date: 19374.67<br />Weight: 0.13829972<br />Asset: ITUB4.SA","Date: 19393.16<br />Weight: 0.13786890<br />Asset: ITUB4.SA","Date: 19411.66<br />Weight: 0.13741969<br />Asset: ITUB4.SA","Date: 19430.15<br />Weight: 0.13698901<br />Asset: ITUB4.SA","Date: 19448.65<br />Weight: 0.13661378<br />Asset: ITUB4.SA","Date: 19467.14<br />Weight: 0.13633094<br />Asset: ITUB4.SA","Date: 19485.63<br />Weight: 0.13617740<br />Asset: ITUB4.SA","Date: 19504.13<br />Weight: 0.13619009<br />Asset: ITUB4.SA","Date: 19522.62<br />Weight: 0.13633779<br />Asset: ITUB4.SA","Date: 19541.11<br />Weight: 0.13649687<br />Asset: ITUB4.SA","Date: 19559.61<br />Weight: 0.13667093<br />Asset: ITUB4.SA","Date: 19578.10<br />Weight: 0.13686812<br />Asset: ITUB4.SA","Date: 19596.59<br />Weight: 0.13709660<br />Asset: ITUB4.SA","Date: 19615.09<br />Weight: 0.13736454<br />Asset: ITUB4.SA","Date: 19633.58<br />Weight: 0.13768008<br />Asset: ITUB4.SA","Date: 19652.08<br />Weight: 0.13805139<br />Asset: ITUB4.SA","Date: 19670.57<br />Weight: 0.13848664<br />Asset: ITUB4.SA","Date: 19689.06<br />Weight: 0.13899397<br />Asset: ITUB4.SA","Date: 19707.56<br />Weight: 0.13957461<br />Asset: ITUB4.SA","Date: 19726.05<br />Weight: 0.14022033<br />Asset: ITUB4.SA","Date: 19744.54<br />Weight: 0.14092900<br />Asset: ITUB4.SA","Date: 19763.04<br />Weight: 0.14169859<br />Asset: ITUB4.SA","Date: 19781.53<br />Weight: 0.14252703<br />Asset: ITUB4.SA","Date: 19800.03<br />Weight: 0.14341230<br />Asset: ITUB4.SA","Date: 19818.52<br />Weight: 0.14435235<br />Asset: ITUB4.SA","Date: 19837.01<br />Weight: 0.14534513<br />Asset: ITUB4.SA","Date: 19855.51<br />Weight: 0.14638859<br />Asset: ITUB4.SA","Date: 19874.00<br />Weight: 0.14748069<br />Asset: ITUB4.SA"],"type":"scatter","mode":"lines","name":"(ITUB4.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(163,165,0,1)","dash":"solid"},"hoveron":"points","legendgroup":"(ITUB4.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.045225285307074078,0.048671736452131402,0.052103868541449688,0.055523404294171567,0.05893206642943763,0.062331577666389117,0.065723660724166688,0.069110038321912898,0.072492433178768342,0.075872568013874306,0.079252245061286988,0.082639909496046743,0.08603505516290702,0.089430124819353474,0.092817561222870978,0.096189807130946436,0.099539305301064779,0.10285849849071159,0.1061398294573718,0.10937574095853229,0.11257456987761356,0.11602328678255096,0.11975917868442311,0.12368750295320387,0.12771351695886493,0.13174247807137873,0.13567964366071691,0.13943027109685346,0.14289961774975996,0.14599294098940888,0.1486638037886131,0.15134028471475136,0.15407233755944055,0.15676791618986805,0.15933497447322062,0.16168146627668681,0.1637153454674532,0.16534456591270724,0.16647708147963614,0.16702084603542763,0.16689893233479525,0.16616901704901493,0.16492006524094627,0.16323540462445413,0.16119836291340425,0.15889226782166205,0.15640044706309353,0.15380622835156316,0.15119293940093687,0.14864390792508017,0.14596655799237179,0.14232681190550089,0.1379246257870082,0.13305855866372737,0.1280271695624931,0.12312901751013705,0.11866266153349384,0.11492666065939713,0.11221957391468104,0.11083996032617809,0.11055447056934703,0.11039977501783121,0.11039751997262819,0.11060492218317509,0.11107919839890909,0.11187756536926735,0.11305723984368678,0.11467543857160491,0.11678937830245882,0.11945627578568559,0.12267406238104739,0.12636989799811693,0.13052979314653368,0.13514044060740898,0.14018853316185312,0.14566076359097932,0.151543824675898,0.15782440919771923,0.16448920993755675,0.17152491967652067],"text":["Date: 18413.00<br />Weight: 0.04522529<br />Asset: PETR4.SA","Date: 18431.49<br />Weight: 0.04867174<br />Asset: PETR4.SA","Date: 18449.99<br />Weight: 0.05210387<br />Asset: PETR4.SA","Date: 18468.48<br />Weight: 0.05552340<br />Asset: PETR4.SA","Date: 18486.97<br />Weight: 0.05893207<br />Asset: PETR4.SA","Date: 18505.47<br />Weight: 0.06233158<br />Asset: PETR4.SA","Date: 18523.96<br />Weight: 0.06572366<br />Asset: PETR4.SA","Date: 18542.46<br />Weight: 0.06911004<br />Asset: PETR4.SA","Date: 18560.95<br />Weight: 0.07249243<br />Asset: PETR4.SA","Date: 18579.44<br />Weight: 0.07587257<br />Asset: PETR4.SA","Date: 18597.94<br />Weight: 0.07925225<br />Asset: PETR4.SA","Date: 18616.43<br />Weight: 0.08263991<br />Asset: PETR4.SA","Date: 18634.92<br />Weight: 0.08603506<br />Asset: PETR4.SA","Date: 18653.42<br />Weight: 0.08943012<br />Asset: PETR4.SA","Date: 18671.91<br />Weight: 0.09281756<br />Asset: PETR4.SA","Date: 18690.41<br />Weight: 0.09618981<br />Asset: PETR4.SA","Date: 18708.90<br />Weight: 0.09953931<br />Asset: PETR4.SA","Date: 18727.39<br />Weight: 0.10285850<br />Asset: PETR4.SA","Date: 18745.89<br />Weight: 0.10613983<br />Asset: PETR4.SA","Date: 18764.38<br />Weight: 0.10937574<br />Asset: PETR4.SA","Date: 18782.87<br />Weight: 0.11257457<br />Asset: PETR4.SA","Date: 18801.37<br />Weight: 0.11602329<br />Asset: PETR4.SA","Date: 18819.86<br />Weight: 0.11975918<br />Asset: PETR4.SA","Date: 18838.35<br />Weight: 0.12368750<br />Asset: PETR4.SA","Date: 18856.85<br />Weight: 0.12771352<br />Asset: PETR4.SA","Date: 18875.34<br />Weight: 0.13174248<br />Asset: PETR4.SA","Date: 18893.84<br />Weight: 0.13567964<br />Asset: PETR4.SA","Date: 18912.33<br />Weight: 0.13943027<br />Asset: PETR4.SA","Date: 18930.82<br />Weight: 0.14289962<br />Asset: PETR4.SA","Date: 18949.32<br />Weight: 0.14599294<br />Asset: PETR4.SA","Date: 18967.81<br />Weight: 0.14866380<br />Asset: PETR4.SA","Date: 18986.30<br />Weight: 0.15134028<br />Asset: PETR4.SA","Date: 19004.80<br />Weight: 0.15407234<br />Asset: PETR4.SA","Date: 19023.29<br />Weight: 0.15676792<br />Asset: PETR4.SA","Date: 19041.78<br />Weight: 0.15933497<br />Asset: PETR4.SA","Date: 19060.28<br />Weight: 0.16168147<br />Asset: PETR4.SA","Date: 19078.77<br />Weight: 0.16371535<br />Asset: PETR4.SA","Date: 19097.27<br />Weight: 0.16534457<br />Asset: PETR4.SA","Date: 19115.76<br />Weight: 0.16647708<br />Asset: PETR4.SA","Date: 19134.25<br />Weight: 0.16702085<br />Asset: PETR4.SA","Date: 19152.75<br />Weight: 0.16689893<br />Asset: PETR4.SA","Date: 19171.24<br />Weight: 0.16616902<br />Asset: PETR4.SA","Date: 19189.73<br />Weight: 0.16492007<br />Asset: PETR4.SA","Date: 19208.23<br />Weight: 0.16323540<br />Asset: PETR4.SA","Date: 19226.72<br />Weight: 0.16119836<br />Asset: PETR4.SA","Date: 19245.22<br />Weight: 0.15889227<br />Asset: PETR4.SA","Date: 19263.71<br />Weight: 0.15640045<br />Asset: PETR4.SA","Date: 19282.20<br />Weight: 0.15380623<br />Asset: PETR4.SA","Date: 19300.70<br />Weight: 0.15119294<br />Asset: PETR4.SA","Date: 19319.19<br />Weight: 0.14864391<br />Asset: PETR4.SA","Date: 19337.68<br />Weight: 0.14596656<br />Asset: PETR4.SA","Date: 19356.18<br />Weight: 0.14232681<br />Asset: PETR4.SA","Date: 19374.67<br />Weight: 0.13792463<br />Asset: PETR4.SA","Date: 19393.16<br />Weight: 0.13305856<br />Asset: PETR4.SA","Date: 19411.66<br />Weight: 0.12802717<br />Asset: PETR4.SA","Date: 19430.15<br />Weight: 0.12312902<br />Asset: PETR4.SA","Date: 19448.65<br />Weight: 0.11866266<br />Asset: PETR4.SA","Date: 19467.14<br />Weight: 0.11492666<br />Asset: PETR4.SA","Date: 19485.63<br />Weight: 0.11221957<br />Asset: PETR4.SA","Date: 19504.13<br />Weight: 0.11083996<br />Asset: PETR4.SA","Date: 19522.62<br />Weight: 0.11055447<br />Asset: PETR4.SA","Date: 19541.11<br />Weight: 0.11039978<br />Asset: PETR4.SA","Date: 19559.61<br />Weight: 0.11039752<br />Asset: PETR4.SA","Date: 19578.10<br />Weight: 0.11060492<br />Asset: PETR4.SA","Date: 19596.59<br />Weight: 0.11107920<br />Asset: PETR4.SA","Date: 19615.09<br />Weight: 0.11187757<br />Asset: PETR4.SA","Date: 19633.58<br />Weight: 0.11305724<br />Asset: PETR4.SA","Date: 19652.08<br />Weight: 0.11467544<br />Asset: PETR4.SA","Date: 19670.57<br />Weight: 0.11678938<br />Asset: PETR4.SA","Date: 19689.06<br />Weight: 0.11945628<br />Asset: PETR4.SA","Date: 19707.56<br />Weight: 0.12267406<br />Asset: PETR4.SA","Date: 19726.05<br />Weight: 0.12636990<br />Asset: PETR4.SA","Date: 19744.54<br />Weight: 0.13052979<br />Asset: PETR4.SA","Date: 19763.04<br />Weight: 0.13514044<br />Asset: PETR4.SA","Date: 19781.53<br />Weight: 0.14018853<br />Asset: PETR4.SA","Date: 19800.03<br />Weight: 0.14566076<br />Asset: PETR4.SA","Date: 19818.52<br />Weight: 0.15154382<br />Asset: PETR4.SA","Date: 19837.01<br />Weight: 0.15782441<br />Asset: PETR4.SA","Date: 19855.51<br />Weight: 0.16448921<br />Asset: PETR4.SA","Date: 19874.00<br />Weight: 0.17152492<br />Asset: PETR4.SA"],"type":"scatter","mode":"lines","name":"(PETR4.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(0,191,125,1)","dash":"solid"},"hoveron":"points","legendgroup":"(PETR4.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.21853921206927027,0.225091040592694,0.23154784312198348,0.23793077126040818,0.24426097661123372,0.25055961077772704,0.25684782536315381,0.26314677197078334,0.26947760220388139,0.27586146766571473,0.28232082082178483,0.28899387008811106,0.29589545047122273,0.30292968964132866,0.31000071526863621,0.31701265502335685,0.32386963657569806,0.3304757875958686,0.3367352357540761,0.34255210872053177,0.34790843113091657,0.35418309564780409,0.3616069661329025,0.36977446015089999,0.37827999526647982,0.38671798904432703,0.39468285904912509,0.40176902284556215,0.40757089799832147,0.41168290207208791,0.41375539486504731,0.41417248506628007,0.41324730078386607,0.41116779568634348,0.40812192344225179,0.40429763772012844,0.39988289218851236,0.39506564051594206,0.39003383637095718,0.38497543342209423,0.37956659544625182,0.37142665642146133,0.36080815342029554,0.34839424650261269,0.33486809572827714,0.32091286115715117,0.30721170284909977,0.29444778086398005,0.28330425526165698,0.27446428610199303,0.26803305670231847,0.26225691626743269,0.2569291030275333,0.25202318666638357,0.24751273686774736,0.24337132331538627,0.23957251569306431,0.23608988368454464,0.23289699697359109,0.22996742524396546,0.22734850829477235,0.22517358842549146,0.22342633146492036,0.22208526149685515,0.22112890260509283,0.22053577887342998,0.2202844143856634,0.22035333322558956,0.22072105947700535,0.2213661172237073,0.22227883057226666,0.22347172564165202,0.22495103068357478,0.22672286293027,0.22879333961397211,0.23116857796691712,0.23385469522133967,0.2368578086094742,0.24018403536355692,0.24383949271582228],"text":["Date: 18413.00<br />Weight: 0.21853921<br />Asset: RADL3.SA","Date: 18431.49<br />Weight: 0.22509104<br />Asset: RADL3.SA","Date: 18449.99<br />Weight: 0.23154784<br />Asset: RADL3.SA","Date: 18468.48<br />Weight: 0.23793077<br />Asset: RADL3.SA","Date: 18486.97<br />Weight: 0.24426098<br />Asset: RADL3.SA","Date: 18505.47<br />Weight: 0.25055961<br />Asset: RADL3.SA","Date: 18523.96<br />Weight: 0.25684783<br />Asset: RADL3.SA","Date: 18542.46<br />Weight: 0.26314677<br />Asset: RADL3.SA","Date: 18560.95<br />Weight: 0.26947760<br />Asset: RADL3.SA","Date: 18579.44<br />Weight: 0.27586147<br />Asset: RADL3.SA","Date: 18597.94<br />Weight: 0.28232082<br />Asset: RADL3.SA","Date: 18616.43<br />Weight: 0.28899387<br />Asset: RADL3.SA","Date: 18634.92<br />Weight: 0.29589545<br />Asset: RADL3.SA","Date: 18653.42<br />Weight: 0.30292969<br />Asset: RADL3.SA","Date: 18671.91<br />Weight: 0.31000072<br />Asset: RADL3.SA","Date: 18690.41<br />Weight: 0.31701266<br />Asset: RADL3.SA","Date: 18708.90<br />Weight: 0.32386964<br />Asset: RADL3.SA","Date: 18727.39<br />Weight: 0.33047579<br />Asset: RADL3.SA","Date: 18745.89<br />Weight: 0.33673524<br />Asset: RADL3.SA","Date: 18764.38<br />Weight: 0.34255211<br />Asset: RADL3.SA","Date: 18782.87<br />Weight: 0.34790843<br />Asset: RADL3.SA","Date: 18801.37<br />Weight: 0.35418310<br />Asset: RADL3.SA","Date: 18819.86<br />Weight: 0.36160697<br />Asset: RADL3.SA","Date: 18838.35<br />Weight: 0.36977446<br />Asset: RADL3.SA","Date: 18856.85<br />Weight: 0.37828000<br />Asset: RADL3.SA","Date: 18875.34<br />Weight: 0.38671799<br />Asset: RADL3.SA","Date: 18893.84<br />Weight: 0.39468286<br />Asset: RADL3.SA","Date: 18912.33<br />Weight: 0.40176902<br />Asset: RADL3.SA","Date: 18930.82<br />Weight: 0.40757090<br />Asset: RADL3.SA","Date: 18949.32<br />Weight: 0.41168290<br />Asset: RADL3.SA","Date: 18967.81<br />Weight: 0.41375539<br />Asset: RADL3.SA","Date: 18986.30<br />Weight: 0.41417249<br />Asset: RADL3.SA","Date: 19004.80<br />Weight: 0.41324730<br />Asset: RADL3.SA","Date: 19023.29<br />Weight: 0.41116780<br />Asset: RADL3.SA","Date: 19041.78<br />Weight: 0.40812192<br />Asset: RADL3.SA","Date: 19060.28<br />Weight: 0.40429764<br />Asset: RADL3.SA","Date: 19078.77<br />Weight: 0.39988289<br />Asset: RADL3.SA","Date: 19097.27<br />Weight: 0.39506564<br />Asset: RADL3.SA","Date: 19115.76<br />Weight: 0.39003384<br />Asset: RADL3.SA","Date: 19134.25<br />Weight: 0.38497543<br />Asset: RADL3.SA","Date: 19152.75<br />Weight: 0.37956660<br />Asset: RADL3.SA","Date: 19171.24<br />Weight: 0.37142666<br />Asset: RADL3.SA","Date: 19189.73<br />Weight: 0.36080815<br />Asset: RADL3.SA","Date: 19208.23<br />Weight: 0.34839425<br />Asset: RADL3.SA","Date: 19226.72<br />Weight: 0.33486810<br />Asset: RADL3.SA","Date: 19245.22<br />Weight: 0.32091286<br />Asset: RADL3.SA","Date: 19263.71<br />Weight: 0.30721170<br />Asset: RADL3.SA","Date: 19282.20<br />Weight: 0.29444778<br />Asset: RADL3.SA","Date: 19300.70<br />Weight: 0.28330426<br />Asset: RADL3.SA","Date: 19319.19<br />Weight: 0.27446429<br />Asset: RADL3.SA","Date: 19337.68<br />Weight: 0.26803306<br />Asset: RADL3.SA","Date: 19356.18<br />Weight: 0.26225692<br />Asset: RADL3.SA","Date: 19374.67<br />Weight: 0.25692910<br />Asset: RADL3.SA","Date: 19393.16<br />Weight: 0.25202319<br />Asset: RADL3.SA","Date: 19411.66<br />Weight: 0.24751274<br />Asset: RADL3.SA","Date: 19430.15<br />Weight: 0.24337132<br />Asset: RADL3.SA","Date: 19448.65<br />Weight: 0.23957252<br />Asset: RADL3.SA","Date: 19467.14<br />Weight: 0.23608988<br />Asset: RADL3.SA","Date: 19485.63<br />Weight: 0.23289700<br />Asset: RADL3.SA","Date: 19504.13<br />Weight: 0.22996743<br />Asset: RADL3.SA","Date: 19522.62<br />Weight: 0.22734851<br />Asset: RADL3.SA","Date: 19541.11<br />Weight: 0.22517359<br />Asset: RADL3.SA","Date: 19559.61<br />Weight: 0.22342633<br />Asset: RADL3.SA","Date: 19578.10<br />Weight: 0.22208526<br />Asset: RADL3.SA","Date: 19596.59<br />Weight: 0.22112890<br />Asset: RADL3.SA","Date: 19615.09<br />Weight: 0.22053578<br />Asset: RADL3.SA","Date: 19633.58<br />Weight: 0.22028441<br />Asset: RADL3.SA","Date: 19652.08<br />Weight: 0.22035333<br />Asset: RADL3.SA","Date: 19670.57<br />Weight: 0.22072106<br />Asset: RADL3.SA","Date: 19689.06<br />Weight: 0.22136612<br />Asset: RADL3.SA","Date: 19707.56<br />Weight: 0.22227883<br />Asset: RADL3.SA","Date: 19726.05<br />Weight: 0.22347173<br />Asset: RADL3.SA","Date: 19744.54<br />Weight: 0.22495103<br />Asset: RADL3.SA","Date: 19763.04<br />Weight: 0.22672286<br />Asset: RADL3.SA","Date: 19781.53<br />Weight: 0.22879334<br />Asset: RADL3.SA","Date: 19800.03<br />Weight: 0.23116858<br />Asset: RADL3.SA","Date: 19818.52<br />Weight: 0.23385470<br />Asset: RADL3.SA","Date: 19837.01<br />Weight: 0.23685781<br />Asset: RADL3.SA","Date: 19855.51<br />Weight: 0.24018404<br />Asset: RADL3.SA","Date: 19874.00<br />Weight: 0.24383949<br />Asset: RADL3.SA"],"type":"scatter","mode":"lines","name":"(RADL3.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(0,176,246,1)","dash":"solid"},"hoveron":"points","legendgroup":"(RADL3.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.31874021825907306,0.31070555405970501,0.30278895647480508,0.29498224044616372,0.28727722091557628,0.27966571282483643,0.27213953111573946,0.26469049073007606,0.25731040660964138,0.24999109369622916,0.24272395698674529,0.23546530389583148,0.22821482229056814,0.22100799456014236,0.21388030309374262,0.20686723028055312,0.20000425850976244,0.19332687017055761,0.18687054765212691,0.18067077334365494,0.17472255861860761,0.16830264715956933,0.16130229918978581,0.1539459752482783,0.14645813587407214,0.13906324160619135,0.13198575298366136,0.12545013054550336,0.11968083483074278,0.11490232637840367,0.11128450520650628,0.10839031684193461,0.10606838528300917,0.10431258557861958,0.10311679277765561,0.10247488192900647,0.10238072808156198,0.10282820628421176,0.10381119158584518,0.10532355903535225,0.10752918679711294,0.111223555638386,0.11625121238573967,0.12230871012460248,0.12909260194040001,0.13629944091855878,0.14362578014450378,0.15076817270366441,0.15742317168146572,0.16328733016333413,0.16855836713118971,0.174751991965338,0.18168929837121101,0.18902005084788182,0.19639401389442221,0.20346095200990827,0.20987062969341175,0.21527281144400567,0.21931726176076269,0.22165374514275743,0.22255160446664049,0.22313348149005205,0.22337727165304805,0.2232194782413747,0.22259660454077781,0.22144515383700339,0.21970162941579782,0.21730253456290635,0.21418437256407535,0.21028364670505068,0.20560293858325077,0.20022346581741393,0.19416068922059609,0.18742930841344807,0.18004402301662217,0.17201953265076639,0.16337053693653306,0.15411173549457474,0.14425782794553879,0.13382351391007774],"text":["Date: 18413.00<br />Weight: 0.31874022<br />Asset: VALE3.SA","Date: 18431.49<br />Weight: 0.31070555<br />Asset: VALE3.SA","Date: 18449.99<br />Weight: 0.30278896<br />Asset: VALE3.SA","Date: 18468.48<br />Weight: 0.29498224<br />Asset: VALE3.SA","Date: 18486.97<br />Weight: 0.28727722<br />Asset: VALE3.SA","Date: 18505.47<br />Weight: 0.27966571<br />Asset: VALE3.SA","Date: 18523.96<br />Weight: 0.27213953<br />Asset: VALE3.SA","Date: 18542.46<br />Weight: 0.26469049<br />Asset: VALE3.SA","Date: 18560.95<br />Weight: 0.25731041<br />Asset: VALE3.SA","Date: 18579.44<br />Weight: 0.24999109<br />Asset: VALE3.SA","Date: 18597.94<br />Weight: 0.24272396<br />Asset: VALE3.SA","Date: 18616.43<br />Weight: 0.23546530<br />Asset: VALE3.SA","Date: 18634.92<br />Weight: 0.22821482<br />Asset: VALE3.SA","Date: 18653.42<br />Weight: 0.22100799<br />Asset: VALE3.SA","Date: 18671.91<br />Weight: 0.21388030<br />Asset: VALE3.SA","Date: 18690.41<br />Weight: 0.20686723<br />Asset: VALE3.SA","Date: 18708.90<br />Weight: 0.20000426<br />Asset: VALE3.SA","Date: 18727.39<br />Weight: 0.19332687<br />Asset: VALE3.SA","Date: 18745.89<br />Weight: 0.18687055<br />Asset: VALE3.SA","Date: 18764.38<br />Weight: 0.18067077<br />Asset: VALE3.SA","Date: 18782.87<br />Weight: 0.17472256<br />Asset: VALE3.SA","Date: 18801.37<br />Weight: 0.16830265<br />Asset: VALE3.SA","Date: 18819.86<br />Weight: 0.16130230<br />Asset: VALE3.SA","Date: 18838.35<br />Weight: 0.15394598<br />Asset: VALE3.SA","Date: 18856.85<br />Weight: 0.14645814<br />Asset: VALE3.SA","Date: 18875.34<br />Weight: 0.13906324<br />Asset: VALE3.SA","Date: 18893.84<br />Weight: 0.13198575<br />Asset: VALE3.SA","Date: 18912.33<br />Weight: 0.12545013<br />Asset: VALE3.SA","Date: 18930.82<br />Weight: 0.11968083<br />Asset: VALE3.SA","Date: 18949.32<br />Weight: 0.11490233<br />Asset: VALE3.SA","Date: 18967.81<br />Weight: 0.11128451<br />Asset: VALE3.SA","Date: 18986.30<br />Weight: 0.10839032<br />Asset: VALE3.SA","Date: 19004.80<br />Weight: 0.10606839<br />Asset: VALE3.SA","Date: 19023.29<br />Weight: 0.10431259<br />Asset: VALE3.SA","Date: 19041.78<br />Weight: 0.10311679<br />Asset: VALE3.SA","Date: 19060.28<br />Weight: 0.10247488<br />Asset: VALE3.SA","Date: 19078.77<br />Weight: 0.10238073<br />Asset: VALE3.SA","Date: 19097.27<br />Weight: 0.10282821<br />Asset: VALE3.SA","Date: 19115.76<br />Weight: 0.10381119<br />Asset: VALE3.SA","Date: 19134.25<br />Weight: 0.10532356<br />Asset: VALE3.SA","Date: 19152.75<br />Weight: 0.10752919<br />Asset: VALE3.SA","Date: 19171.24<br />Weight: 0.11122356<br />Asset: VALE3.SA","Date: 19189.73<br />Weight: 0.11625121<br />Asset: VALE3.SA","Date: 19208.23<br />Weight: 0.12230871<br />Asset: VALE3.SA","Date: 19226.72<br />Weight: 0.12909260<br />Asset: VALE3.SA","Date: 19245.22<br />Weight: 0.13629944<br />Asset: VALE3.SA","Date: 19263.71<br />Weight: 0.14362578<br />Asset: VALE3.SA","Date: 19282.20<br />Weight: 0.15076817<br />Asset: VALE3.SA","Date: 19300.70<br />Weight: 0.15742317<br />Asset: VALE3.SA","Date: 19319.19<br />Weight: 0.16328733<br />Asset: VALE3.SA","Date: 19337.68<br />Weight: 0.16855837<br />Asset: VALE3.SA","Date: 19356.18<br />Weight: 0.17475199<br />Asset: VALE3.SA","Date: 19374.67<br />Weight: 0.18168930<br />Asset: VALE3.SA","Date: 19393.16<br />Weight: 0.18902005<br />Asset: VALE3.SA","Date: 19411.66<br />Weight: 0.19639401<br />Asset: VALE3.SA","Date: 19430.15<br />Weight: 0.20346095<br />Asset: VALE3.SA","Date: 19448.65<br />Weight: 0.20987063<br />Asset: VALE3.SA","Date: 19467.14<br />Weight: 0.21527281<br />Asset: VALE3.SA","Date: 19485.63<br />Weight: 0.21931726<br />Asset: VALE3.SA","Date: 19504.13<br />Weight: 0.22165375<br />Asset: VALE3.SA","Date: 19522.62<br />Weight: 0.22255160<br />Asset: VALE3.SA","Date: 19541.11<br />Weight: 0.22313348<br />Asset: VALE3.SA","Date: 19559.61<br />Weight: 0.22337727<br />Asset: VALE3.SA","Date: 19578.10<br />Weight: 0.22321948<br />Asset: VALE3.SA","Date: 19596.59<br />Weight: 0.22259660<br />Asset: VALE3.SA","Date: 19615.09<br />Weight: 0.22144515<br />Asset: VALE3.SA","Date: 19633.58<br />Weight: 0.21970163<br />Asset: VALE3.SA","Date: 19652.08<br />Weight: 0.21730253<br />Asset: VALE3.SA","Date: 19670.57<br />Weight: 0.21418437<br />Asset: VALE3.SA","Date: 19689.06<br />Weight: 0.21028365<br />Asset: VALE3.SA","Date: 19707.56<br />Weight: 0.20560294<br />Asset: VALE3.SA","Date: 19726.05<br />Weight: 0.20022347<br />Asset: VALE3.SA","Date: 19744.54<br />Weight: 0.19416069<br />Asset: VALE3.SA","Date: 19763.04<br />Weight: 0.18742931<br />Asset: VALE3.SA","Date: 19781.53<br />Weight: 0.18004402<br />Asset: VALE3.SA","Date: 19800.03<br />Weight: 0.17201953<br />Asset: VALE3.SA","Date: 19818.52<br />Weight: 0.16337054<br />Asset: VALE3.SA","Date: 19837.01<br />Weight: 0.15411174<br />Asset: VALE3.SA","Date: 19855.51<br />Weight: 0.14425783<br />Asset: VALE3.SA","Date: 19874.00<br />Weight: 0.13382351<br />Asset: VALE3.SA"],"type":"scatter","mode":"lines","name":"(VALE3.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(231,107,243,1)","dash":"solid"},"hoveron":"points","legendgroup":"(VALE3.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":47.481942714819425,"r":7.3059360730593621,"b":40.182648401826491,"l":43.105022831050235},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"<b> Peso dos ativos rebalanceados ao longo do tempo <\/b>","font":{"color":"rgba(0,0,0,1)","family":"","size":21.253632212536321},"x":0.5,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[18339.950000000001,19947.049999999999],"tickmode":"array","ticktext":["2021","2022","2023","2024"],"tickvals":[18628,18993,19358,19723],"categoryorder":"array","categoryarray":["2021","2022","2023","2024"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Data","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.026777925319113778,0.43261984505424039],"tickmode":"array","ticktext":["0.1","0.2","0.3","0.4"],"tickvals":[0.10000000000000001,0.20000000000000001,0.30000000000000004,0.40000000000000002],"categoryorder":"array","categoryarray":["0.1","0.2","0.3","0.4"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Peso","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Ativos","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"480413a94dce":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"480413a94dce","visdat":{"480413a94dce":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="plotando-o-retorno-do-portfólio-ao-longo-do-tempo" class="level2">
<h2 class="anchored" data-anchor-id="plotando-o-retorno-do-portfólio-ao-longo-do-tempo">Plotando o retorno do portfólio ao longo do tempo</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando o retorno do portfólio otimizado e adicionando o retorno do IBOV</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>opt_returns_long_df <span class="ot">&lt;-</span> <span class="fu">Return.portfolio</span>(<span class="at">R =</span> asset_returns_xts, <span class="at">weights =</span> <span class="fu">extractWeights</span>(opt_rebal)) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tk_tbl</span>(<span class="at">preserve_index =</span> <span class="cn">TRUE</span>, <span class="at">rename_index =</span> <span class="st">"Date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(ibov_returns_xts <span class="sc">%&gt;%</span> <span class="fu">tk_tbl</span>(<span class="at">preserve_index =</span> <span class="cn">TRUE</span>, <span class="at">rename_index =</span> <span class="st">"Date"</span>), <span class="at">by =</span> <span class="st">"Date"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_Portfolio"</span>, <span class="st">"_IBOV"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Date, <span class="at">names_to =</span> <span class="st">"Portfolio"</span>, <span class="at">values_to =</span> <span class="st">"Return"</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(<span class="fu">ggplot</span>(opt_returns_long_df) <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Return, <span class="at">colour =</span> Portfolio) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hue</span>(<span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Data"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Retorno"</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Retorno do portifólio vs IBOV ao longo do tempo"</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"Portfólio"</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>L,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-f64b2040dc583cedae2a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f64b2040dc583cedae2a">{"x":{"data":[{"x":[18443,18474,18505,18535,18566,18596,18627,18658,18686,18717,18747,18778,18808,18839,18870,18900,18931,18961,18992,19023,19051,19082,19112,19143,19173,19204,19235,19265,19296,19326,19357,19388,19416,19447,19477,19508,19538,19569,19600,19630,19661,19691,19722,19753,19782,19813,19843,19874],"y":[0.087559923572417375,0.082646019188688857,-0.034427472014925353,-0.047962644285441169,-0.0068813885394755081,0.1589747956403269,0.095676291235030408,-0.027651584999916157,-0.051479652089960082,0.059971827145908208,0.019376854090573881,0.061584268339865744,0.0046428345059263965,-0.039439441018280452,-0.024794541916733026,-0.065683905675150034,-0.067382117337514313,-0.015323523444217946,0.028523769808173505,0.072179504302531949,0.0067089013061891745,0.060605257110533772,-0.10102584188201569,0.032212911120174992,-0.11503264452048023,0.046914006210549752,0.061629428585276091,0.0046930781662299914,0.054527113607241162,-0.030602307884554092,-0.021824938214533351,0.031818305750197728,-0.075749568403621903,-0.029066443029771682,0.02502895506566416,0.037373601961084635,0.090017076660358963,0.032653890775445227,-0.050851627399686739,0.0071106426362081976,-0.029348432205207442,0.12538888496075806,0.053828211511729229,-0.047941275105265135,0.0099254806186988009,-0.0070841729964347122,-0.017032769737561071,-0.025547155427082968],"text":["Date: 2020-06-30<br />Return:  0.087559924<br />Portfolio: IBOV","Date: 2020-07-31<br />Return:  0.082646019<br />Portfolio: IBOV","Date: 2020-08-31<br />Return: -0.034427472<br />Portfolio: IBOV","Date: 2020-09-30<br />Return: -0.047962644<br />Portfolio: IBOV","Date: 2020-10-31<br />Return: -0.006881389<br />Portfolio: IBOV","Date: 2020-11-30<br />Return:  0.158974796<br />Portfolio: IBOV","Date: 2020-12-31<br />Return:  0.095676291<br />Portfolio: IBOV","Date: 2021-01-31<br />Return: -0.027651585<br />Portfolio: IBOV","Date: 2021-02-28<br />Return: -0.051479652<br />Portfolio: IBOV","Date: 2021-03-31<br />Return:  0.059971827<br />Portfolio: IBOV","Date: 2021-04-30<br />Return:  0.019376854<br />Portfolio: IBOV","Date: 2021-05-31<br />Return:  0.061584268<br />Portfolio: IBOV","Date: 2021-06-30<br />Return:  0.004642835<br />Portfolio: IBOV","Date: 2021-07-31<br />Return: -0.039439441<br />Portfolio: IBOV","Date: 2021-08-31<br />Return: -0.024794542<br />Portfolio: IBOV","Date: 2021-09-30<br />Return: -0.065683906<br />Portfolio: IBOV","Date: 2021-10-31<br />Return: -0.067382117<br />Portfolio: IBOV","Date: 2021-11-30<br />Return: -0.015323523<br />Portfolio: IBOV","Date: 2021-12-31<br />Return:  0.028523770<br />Portfolio: IBOV","Date: 2022-01-31<br />Return:  0.072179504<br />Portfolio: IBOV","Date: 2022-02-28<br />Return:  0.006708901<br />Portfolio: IBOV","Date: 2022-03-31<br />Return:  0.060605257<br />Portfolio: IBOV","Date: 2022-04-30<br />Return: -0.101025842<br />Portfolio: IBOV","Date: 2022-05-31<br />Return:  0.032212911<br />Portfolio: IBOV","Date: 2022-06-30<br />Return: -0.115032645<br />Portfolio: IBOV","Date: 2022-07-31<br />Return:  0.046914006<br />Portfolio: IBOV","Date: 2022-08-31<br />Return:  0.061629429<br />Portfolio: IBOV","Date: 2022-09-30<br />Return:  0.004693078<br />Portfolio: IBOV","Date: 2022-10-31<br />Return:  0.054527114<br />Portfolio: IBOV","Date: 2022-11-30<br />Return: -0.030602308<br />Portfolio: IBOV","Date: 2022-12-31<br />Return: -0.021824938<br />Portfolio: IBOV","Date: 2023-01-31<br />Return:  0.031818306<br />Portfolio: IBOV","Date: 2023-02-28<br />Return: -0.075749568<br />Portfolio: IBOV","Date: 2023-03-31<br />Return: -0.029066443<br />Portfolio: IBOV","Date: 2023-04-30<br />Return:  0.025028955<br />Portfolio: IBOV","Date: 2023-05-31<br />Return:  0.037373602<br />Portfolio: IBOV","Date: 2023-06-30<br />Return:  0.090017077<br />Portfolio: IBOV","Date: 2023-07-31<br />Return:  0.032653891<br />Portfolio: IBOV","Date: 2023-08-31<br />Return: -0.050851627<br />Portfolio: IBOV","Date: 2023-09-30<br />Return:  0.007110643<br />Portfolio: IBOV","Date: 2023-10-31<br />Return: -0.029348432<br />Portfolio: IBOV","Date: 2023-11-30<br />Return:  0.125388885<br />Portfolio: IBOV","Date: 2023-12-31<br />Return:  0.053828212<br />Portfolio: IBOV","Date: 2024-01-31<br />Return: -0.047941275<br />Portfolio: IBOV","Date: 2024-02-29<br />Return:  0.009925481<br />Portfolio: IBOV","Date: 2024-03-31<br />Return: -0.007084173<br />Portfolio: IBOV","Date: 2024-04-30<br />Return: -0.017032770<br />Portfolio: IBOV","Date: 2024-05-31<br />Return: -0.025547155<br />Portfolio: IBOV"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"(IBOV,1)","legendgroup":"(IBOV,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18443,18474,18505,18535,18566,18596,18627,18658,18686,18717,18747,18778,18808,18839,18870,18900,18931,18961,18992,19023,19051,19082,19112,19143,19173,19204,19235,19265,19296,19326,19357,19388,19416,19447,19477,19508,19538,19569,19600,19630,19661,19691,19722,19753,19782,19813,19843,19874],"y":[0.041128040133942223,0.08875633056847998,-0.07307925041079455,0.0099493662553633566,0.021333578600998715,0.21040746094248997,0.090641002342705113,-0.027383328999471046,-0.054098752678449213,0.085923368482005102,0.060257322328044705,0.084018126669554549,-0.042333277520113621,-0.018020232139140502,0.047648353380866926,-0.03649371615842012,-0.045153731109021877,-0.01418441383819069,0.065613138865086906,0.050181326347043864,0.024254055600554825,0.10570686642333693,-0.09704527493524584,0.034481411984542465,-0.083468590389152553,0.096439384167512632,0.077505862661473302,-0.0086220905930026737,0.056798327876332433,-0.013839951104092529,-0.0014790865730139879,0.041421202790973499,-0.074198922584979621,0.032889625793366184,0.062994425461039505,-0.0076728061267468117,0.069628828613294225,0.01671497013956591,-0.030240425171108032,0.023515710213002583,-0.027114274133064442,0.056763740068642932,0.064648879299665563,-0.035565531506970283,0.030270042595018865,0.016625282212390013,0.016750769862189152,0.0019736862266457322],"text":["Date: 2020-06-30<br />Return:  0.041128040<br />Portfolio: portfolio.returns","Date: 2020-07-31<br />Return:  0.088756331<br />Portfolio: portfolio.returns","Date: 2020-08-31<br />Return: -0.073079250<br />Portfolio: portfolio.returns","Date: 2020-09-30<br />Return:  0.009949366<br />Portfolio: portfolio.returns","Date: 2020-10-31<br />Return:  0.021333579<br />Portfolio: portfolio.returns","Date: 2020-11-30<br />Return:  0.210407461<br />Portfolio: portfolio.returns","Date: 2020-12-31<br />Return:  0.090641002<br />Portfolio: portfolio.returns","Date: 2021-01-31<br />Return: -0.027383329<br />Portfolio: portfolio.returns","Date: 2021-02-28<br />Return: -0.054098753<br />Portfolio: portfolio.returns","Date: 2021-03-31<br />Return:  0.085923368<br />Portfolio: portfolio.returns","Date: 2021-04-30<br />Return:  0.060257322<br />Portfolio: portfolio.returns","Date: 2021-05-31<br />Return:  0.084018127<br />Portfolio: portfolio.returns","Date: 2021-06-30<br />Return: -0.042333278<br />Portfolio: portfolio.returns","Date: 2021-07-31<br />Return: -0.018020232<br />Portfolio: portfolio.returns","Date: 2021-08-31<br />Return:  0.047648353<br />Portfolio: portfolio.returns","Date: 2021-09-30<br />Return: -0.036493716<br />Portfolio: portfolio.returns","Date: 2021-10-31<br />Return: -0.045153731<br />Portfolio: portfolio.returns","Date: 2021-11-30<br />Return: -0.014184414<br />Portfolio: portfolio.returns","Date: 2021-12-31<br />Return:  0.065613139<br />Portfolio: portfolio.returns","Date: 2022-01-31<br />Return:  0.050181326<br />Portfolio: portfolio.returns","Date: 2022-02-28<br />Return:  0.024254056<br />Portfolio: portfolio.returns","Date: 2022-03-31<br />Return:  0.105706866<br />Portfolio: portfolio.returns","Date: 2022-04-30<br />Return: -0.097045275<br />Portfolio: portfolio.returns","Date: 2022-05-31<br />Return:  0.034481412<br />Portfolio: portfolio.returns","Date: 2022-06-30<br />Return: -0.083468590<br />Portfolio: portfolio.returns","Date: 2022-07-31<br />Return:  0.096439384<br />Portfolio: portfolio.returns","Date: 2022-08-31<br />Return:  0.077505863<br />Portfolio: portfolio.returns","Date: 2022-09-30<br />Return: -0.008622091<br />Portfolio: portfolio.returns","Date: 2022-10-31<br />Return:  0.056798328<br />Portfolio: portfolio.returns","Date: 2022-11-30<br />Return: -0.013839951<br />Portfolio: portfolio.returns","Date: 2022-12-31<br />Return: -0.001479087<br />Portfolio: portfolio.returns","Date: 2023-01-31<br />Return:  0.041421203<br />Portfolio: portfolio.returns","Date: 2023-02-28<br />Return: -0.074198923<br />Portfolio: portfolio.returns","Date: 2023-03-31<br />Return:  0.032889626<br />Portfolio: portfolio.returns","Date: 2023-04-30<br />Return:  0.062994425<br />Portfolio: portfolio.returns","Date: 2023-05-31<br />Return: -0.007672806<br />Portfolio: portfolio.returns","Date: 2023-06-30<br />Return:  0.069628829<br />Portfolio: portfolio.returns","Date: 2023-07-31<br />Return:  0.016714970<br />Portfolio: portfolio.returns","Date: 2023-08-31<br />Return: -0.030240425<br />Portfolio: portfolio.returns","Date: 2023-09-30<br />Return:  0.023515710<br />Portfolio: portfolio.returns","Date: 2023-10-31<br />Return: -0.027114274<br />Portfolio: portfolio.returns","Date: 2023-11-30<br />Return:  0.056763740<br />Portfolio: portfolio.returns","Date: 2023-12-31<br />Return:  0.064648879<br />Portfolio: portfolio.returns","Date: 2024-01-31<br />Return: -0.035565532<br />Portfolio: portfolio.returns","Date: 2024-02-29<br />Return:  0.030270043<br />Portfolio: portfolio.returns","Date: 2024-03-31<br />Return:  0.016625282<br />Portfolio: portfolio.returns","Date: 2024-04-30<br />Return:  0.016750770<br />Portfolio: portfolio.returns","Date: 2024-05-31<br />Return:  0.001973686<br />Portfolio: portfolio.returns"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"(portfolio.returns,1)","legendgroup":"(portfolio.returns,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":47.481942714819425,"r":7.3059360730593621,"b":40.182648401826491,"l":48.949771689497723},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"<b> Retorno do portifólio vs IBOV ao longo do tempo <\/b>","font":{"color":"rgba(0,0,0,1)","family":"","size":21.253632212536321},"x":0.5,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[18371.450000000001,19945.549999999999],"tickmode":"array","ticktext":["2021","2022","2023","2024"],"tickvals":[18628,18993,19358,19723],"categoryorder":"array","categoryarray":["2021","2022","2023","2024"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Data","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.13130464979362874,0.22667946621563848],"tickmode":"array","ticktext":["-0.1","0.0","0.1","0.2"],"tickvals":[-0.10000000000000001,0,0.10000000000000001,0.20000000000000004],"categoryorder":"array","categoryarray":["-0.1","0.0","0.1","0.2"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Retorno","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Portfólio","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"48041a3d4b1":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"48041a3d4b1","visdat":{"48041a3d4b1":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="bonus-plotando-a-fronteira-eficiente" class="level2">
<h2 class="anchored" data-anchor-id="bonus-plotando-a-fronteira-eficiente">Bonus: Plotando a fronteira eficiente</h2>
<p>A fronteira eficiente é uma curva que mostra a combinação ótima de ativos em uma carteira que maximiza o retorno esperado para um determinado nível de risco. Note que o indice de Sharpe é a inclinação da linha tangente a fronteira eficiente, o intercepto com o eixo y é o retorno livre de risco e o ponto de tangência é o ponto com o maior indice de Sharpe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando a fronteira eficiente</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>frontier <span class="ot">&lt;-</span> <span class="fu">create.EfficientFrontier</span>(<span class="at">R =</span> asset_returns_xts, <span class="at">portfolio =</span> port_spec, <span class="at">type =</span> <span class="st">"mean-StdDev"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotando a fronteira eficiente</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.EfficientFrontier</span>(frontier, <span class="at">match.col =</span> <span class="st">"StdDev"</span>,<span class="at">n.portfolios =</span> <span class="dv">30</span>, <span class="at">main =</span> <span class="st">"Fronteira eficiente"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="otimização_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="dashboards-interativos-com-quarto" class="level2">
<h2 class="anchored" data-anchor-id="dashboards-interativos-com-quarto">Dashboards interativos com QUARTO</h2>
<p><a href="https://quarto.org/docs/dashboards/">Clique aqui!!</a></p>
</section>
<section id="exercício" class="level2">
<h2 class="anchored" data-anchor-id="exercício">Exercício</h2>
<ul>
<li>Crie uma carteira com 5 ativos de sua escolha</li>
<li>Baixe os preços dos ativos</li>
<li>Calcule os retornos mensais</li>
<li>Crie um vetor de pesos para a carteira</li>
<li>Calcule o retorno da carteira</li>
<li>Faça a otimização da carteira com o objetivo de maximizar o retorno esperado e minimizar o risco</li>
<li>Opcionalmente faça a otimização com rebalanceamento</li>
<li>Visualize o retorno da carteira e dos ativos</li>
<li>Compare o retorno da carteira com o índice do mercado</li>
<li>Salve o seu dashboard e compartilhe com o professor</li>
</ul>
</section>
<section id="dica-use-o-arquivo-das-aulas-anteriores-como-referência-para-criar-o-seu-dashboard" class="level2">
<h2 class="anchored" data-anchor-id="dica-use-o-arquivo-das-aulas-anteriores-como-referência-para-criar-o-seu-dashboard">Dica: Use o arquivo das aulas anteriores como referência para criar o seu dashboard</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>