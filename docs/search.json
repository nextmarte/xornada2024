[
  {
    "objectID": "otimização.html",
    "href": "otimização.html",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "",
    "text": "Risco: Probabilidade de um resultado adverso em relação ao esperado."
  },
  {
    "objectID": "otimização.html#relembrando-alguns-conceitos-sobre-risco",
    "href": "otimização.html#relembrando-alguns-conceitos-sobre-risco",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "",
    "text": "Risco: Probabilidade de um resultado adverso em relação ao esperado."
  },
  {
    "objectID": "otimização.html#tipos-de-risco",
    "href": "otimização.html#tipos-de-risco",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Tipos de risco",
    "text": "Tipos de risco\n\nRisco conhecido: Distribuição de probabilidade do evento é conhecida (ex: falha de motor).\nIncerteza: Distribuição de probabilidade desconhecida ou imprevisível (ex: crise econômica)."
  },
  {
    "objectID": "otimização.html#atitudes-frente-ao-risco",
    "href": "otimização.html#atitudes-frente-ao-risco",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Atitudes frente ao risco",
    "text": "Atitudes frente ao risco\n\nAversão: Prefere menor risco para mesmo retorno.\nIndiferença: Não se importa com o risco.\nPropensão: Aceita maior risco por potencial de maior retorno.\n\n\nO participante de uma apólice de seguros têm que predisposição frente ao risco?\nE a companhia de seguros?"
  },
  {
    "objectID": "otimização.html#mensuração-do-risco",
    "href": "otimização.html#mensuração-do-risco",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Mensuração do Risco",
    "text": "Mensuração do Risco\n\nDesvio padrão (σ): Mede a dispersão dos resultados em torno da média.\nCoeficiente de variação (CV): Mede o risco por unidade de retorno (σ / retorno médio)."
  },
  {
    "objectID": "otimização.html#risco-de-carteira",
    "href": "otimização.html#risco-de-carteira",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Risco de Carteira",
    "text": "Risco de Carteira\n\nCovariância: Mede a relação entre os retornos de dois ativos.\nDiversificação: Reduz o risco total da carteira ao combinar ativos com diferentes riscos (Markowitz, 1952) - “Não colocar todos os ovos na mesma cesta”."
  },
  {
    "objectID": "otimização.html#risco-individual-vs.-sistêmico",
    "href": "otimização.html#risco-individual-vs.-sistêmico",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Risco individual vs. sistêmico",
    "text": "Risco individual vs. sistêmico\n\nIndividual: Específico de cada ativo.\nSistêmico: Afeta todo o mercado."
  },
  {
    "objectID": "otimização.html#índice-sharpe-is",
    "href": "otimização.html#índice-sharpe-is",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Índice Sharpe (IS)",
    "text": "Índice Sharpe (IS)\n\nDefinição: Mede o retorno adicional por unidade de risco em relação à taxa livre de risco.\nFórmula: IS = (Retorno médio do portfólio - Taxa livre de risco) / Desvio padrão do excesso de retorno.\ninterpretação: IS &gt; 1: Retorno adicional por unidade de risco; IS &lt; 1: Retorno insuficiente por unidade de risco. Quantos mais alto o índice, melhor."
  },
  {
    "objectID": "otimização.html#beta-β",
    "href": "otimização.html#beta-β",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Beta (β)",
    "text": "Beta (β)\n\nDefinição: Mede a sensibilidade do retorno de um ativo em relação ao retorno do mercado.\nFórmula: β = Cov(Ri, Rm) / Var(Rm).\nInterpretação: β &gt; 1: Ativo mais volátil que o mercado; β &lt; 1: Ativo menos volátil que o mercado.\nExemplo: Se β = 1, o ativo se move na mesma direção que o mercado."
  },
  {
    "objectID": "otimização.html#alfa-α",
    "href": "otimização.html#alfa-α",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Alfa (α)",
    "text": "Alfa (α)\n\nDefinição: Mede o retorno adicional de um ativo em relação ao retorno esperado com base no risco.\nFórmula: α = Retorno do ativo - (Taxa livre de risco + β * (Retorno do mercado - Taxa livre de risco)).\nInterpretação: α &gt; 0: Ativo superou o retorno esperado; α &lt; 0: Ativo ficou aquém do retorno esperado.\nExemplo: Se α = 0, o ativo teve o retorno esperado com base no risco.\nObservação: O alfa é uma medida de desempenho ajustada ao risco."
  },
  {
    "objectID": "otimização.html#função-de-utilidade-quadrática",
    "href": "otimização.html#função-de-utilidade-quadrática",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Função de utilidade quadrática",
    "text": "Função de utilidade quadrática\nA função de utilidade quadrática é usada na otimização de portfólios para encontrar a alocação de ativos que maximiza o retorno esperado e minimiza o risco. A função de utilidade quadrática é dada por:\n\\(U = \\mu^T w - \\lambda \\sigma^2\\)\nonde:\n\n\\(U\\) é a função de utilidade\n\\(\\mu^T\\) é o vetor de retornos esperados\n\\(w\\) é o vetor de pesos dos ativos\n\\(\\lambda\\) é o fator de aversão ao risco\n\ngeneralizando para o caso de \\(n\\) ativos, a função de utilidade quadrática é dada por:\n\\(U = \\mu^T w - \\lambda w^T \\Sigma w\\)\nonde:\n\n\\(\\Sigma w\\) é a matriz de covariância dos retornos dos ativos\n\\(w^T\\) é o vetor transposto de pesos dos ativos\n\\(w\\) é o vetor de pesos dos ativos\n\\(\\lambda\\) é o fator de aversão ao risco\n\\(\\mu\\) é o vetor de retornos esperados\n\\(U\\) é a função de utilidade"
  },
  {
    "objectID": "otimização.html#otimização-de-portfólios",
    "href": "otimização.html#otimização-de-portfólios",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Otimização de portfólios",
    "text": "Otimização de portfólios\nA otimização de portfólios é um problema de maximização da função de utilidade quadrática sujeita a restrições, como a soma dos pesos dos ativos deve ser igual a 1 e os pesos dos ativos devem ser maiores ou iguais a zero."
  },
  {
    "objectID": "otimização.html#primeiro-vamos-carregar-os-pacotes-necessários",
    "href": "otimização.html#primeiro-vamos-carregar-os-pacotes-necessários",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Primeiro vamos carregar os pacotes necessários",
    "text": "Primeiro vamos carregar os pacotes necessários"
  },
  {
    "objectID": "otimização.html#ativos-selecionados",
    "href": "otimização.html#ativos-selecionados",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Ativos selecionados",
    "text": "Ativos selecionados\n\n# Ativos selecionados\n\ntickers &lt;- c(\"VALE3.SA\",\"PETR4.SA\",\"CMIG4.SA\",\"RADL3.SA\",\"ITUB4.SA\")\n\nprices &lt;- \n  getSymbols(tickers, \n             src = 'yahoo', \n             from = \"2019-05-30\",\n             to = \"2024-05-30\",\n             auto.assign = TRUE, #obs auto asign carrega os resultados para o ambiente\n             warnings = FALSE,) %&gt;% \n  map(~Ad(get(.))) %&gt;% \n  reduce(merge) %&gt;%\n  `colnames&lt;-`(tickers)"
  },
  {
    "objectID": "otimização.html#baixando-os-preços-do-benchmark",
    "href": "otimização.html#baixando-os-preços-do-benchmark",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Baixando os preços do benchmark",
    "text": "Baixando os preços do benchmark\n\n# Baixando os preços do IBOV\n\nibov &lt;- getSymbols(\"^BVSP\", \n                   src = 'yahoo', \n                   from = \"2019-05-30\",\n                   to = \"2024-05-30\",\n                   auto.assign = TRUE, \n                   warnings = FALSE) %&gt;% \n  map(~Ad(get(.))) %&gt;% \n  reduce(merge) %&gt;% \n  `colnames&lt;-`(\"IBOV\")\n\nhead(ibov)\n\n            IBOV\n2019-05-30 97457\n2019-05-31 97030\n2019-06-03 97020\n2019-06-04 97380\n2019-06-05 95999\n2019-06-06 97205"
  },
  {
    "objectID": "otimização.html#agora-vamos-converter-os-preços-diários-em-mensais",
    "href": "otimização.html#agora-vamos-converter-os-preços-diários-em-mensais",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Agora vamos converter os preços diários em mensais",
    "text": "Agora vamos converter os preços diários em mensais\n\nprices_monthly &lt;- to.monthly(prices, indexAt = \"lastof\", OHLC = FALSE)\nhead(prices_monthly)\n\n           VALE3.SA  PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA\n2019-05-31 30.86573  8.593932 4.256697 12.65753 28.16351\n2019-06-30 32.64209  9.219558 4.282653 13.90627 29.18991\n2019-07-31 31.37597  8.772201 4.077893 15.16898 28.04227\n2019-08-31 28.70514  8.644517 4.256697 16.81909 27.53359\n2019-09-30 30.07835  9.339466 4.132688 17.53679 28.43042\n2019-10-31 29.73190 10.302230 3.936579 20.13409 29.41695\n\nibov_monthly &lt;- to.monthly(ibov, indexAt = \"lastof\", OHLC = FALSE)\nhead(ibov_monthly)\n\n             IBOV\n2019-05-31  97030\n2019-06-30 100967\n2019-07-31 101812\n2019-08-31 101135\n2019-09-30 104745\n2019-10-31 107220"
  },
  {
    "objectID": "otimização.html#vamos-calcular-os-retornos-mensais",
    "href": "otimização.html#vamos-calcular-os-retornos-mensais",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Vamos calcular os retornos mensais",
    "text": "Vamos calcular os retornos mensais\n\nasset_returns_xts &lt;-\n PerformanceAnalytics::Return.calculate(prices_monthly, \n                   method = \"discrete\") %&gt;% \n  na.omit()\n\nibov_returns_xts &lt;- \n  PerformanceAnalytics::Return.calculate(ibov_monthly, \n                   method = \"discrete\") %&gt;% \n  na.omit()\n\nhead(asset_returns_xts)\n\n              VALE3.SA    PETR4.SA     CMIG4.SA   RADL3.SA    ITUB4.SA\n2019-06-30  0.05755125  0.07279853  0.006097609 0.09865537  0.03644424\n2019-07-31 -0.03878816 -0.04852263 -0.047811393 0.09080148 -0.03931640\n2019-08-31 -0.08512349 -0.01455549  0.043847131 0.10878217 -0.01813957\n2019-09-30  0.04783858  0.08039190 -0.029132712 0.04267203  0.03257206\n2019-10-31 -0.01151822  0.10308553 -0.047453263 0.14810561  0.03469968\n2019-11-30  0.05889835 -0.03443176 -0.043955720 0.02718191 -0.03907229\n\nhead(ibov_returns_xts)\n\n                   IBOV\n2019-06-30  0.040575080\n2019-07-31  0.008369071\n2019-08-31 -0.006649511\n2019-09-30  0.035694863\n2019-10-31  0.023628813\n2019-11-30  0.009447864"
  },
  {
    "objectID": "otimização.html#otimização-da-carteira",
    "href": "otimização.html#otimização-da-carteira",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Otimização da carteira",
    "text": "Otimização da carteira\n\n#| message: false\n\n# Criando o objeto de otimização\n\nportf &lt;- portfolio.spec(assets = colnames(asset_returns_xts))\n\n# Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1\n\nportf &lt;- add.constraint(portf,\n    type = \"weight_sum\",\n    min_sum = 0.99, max_sum = 1.01\n)\n\n# Adicionando restrição de peso mínimo e máximo para cada ativo\n# Neste caso, o peso mínimo é 0 e o peso máximo é 1\n\nportf &lt;- add.constraint(portf, type = \"long_only\")\n\n\n# Adiciona a função objetivo, que é minimizar o desvio padrão da carteira\n\nportf &lt;- add.objective(portf, type = \"risk\", name = \"StdDev\")\n\nportf &lt;- add.objective(portf,\n    type = \"return\", name = \"mean\"\n)\n\n# Resolve o problema de otimização\n\nopt_portf &lt;- optimize.portfolio(asset_returns_xts,\n                                portf,\n                                optimize_method = \"ROI\",\n                                maxSR = TRUE,\n                                trace = TRUE)"
  },
  {
    "objectID": "otimização.html#resultados-da-otimização",
    "href": "otimização.html#resultados-da-otimização",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Resultados da otimização",
    "text": "Resultados da otimização\n\nopt_portf\n\n***********************************\nPortfolioAnalytics Optimization\n***********************************\n\nCall:\noptimize.portfolio(R = asset_returns_xts, portfolio = portf, \n    optimize_method = \"ROI\", trace = TRUE, maxSR = TRUE)\n\nOptimal Weights:\nVALE3.SA PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA \n  0.2608   0.3838   0.0000   0.3511   0.0000 \n\nObjective Measure:\n StdDev \n0.06709 \n\n\n   mean \n0.02114"
  },
  {
    "objectID": "otimização.html#extraindo-os-pesos-dos-ativos",
    "href": "otimização.html#extraindo-os-pesos-dos-ativos",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Extraindo os pesos dos ativos",
    "text": "Extraindo os pesos dos ativos\n\n# extraindo os pesos para um data frame\nweights &lt;- extractWeights(opt_portf)\n\n# Adicionando os nomes dos ativos sem colocá-los no índice\nweights &lt;- data.frame(tickers = colnames(asset_returns_xts), weights, row.names = NULL)\n\nweights\n\n   tickers       weights\n1 VALE3.SA  2.608392e-01\n2 PETR4.SA  3.837557e-01\n3 CMIG4.SA -1.387779e-17\n4 RADL3.SA  3.511171e-01\n5 ITUB4.SA  2.411089e-18"
  },
  {
    "objectID": "otimização.html#plotando-com-o-portfolioanalytics",
    "href": "otimização.html#plotando-com-o-portfolioanalytics",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "plotando com o portfolioAnalytics",
    "text": "plotando com o portfolioAnalytics\n\nchart.Weights(opt_portf)"
  },
  {
    "objectID": "otimização.html#plotando-com-ggplo2",
    "href": "otimização.html#plotando-com-ggplo2",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Plotando com ggplo2",
    "text": "Plotando com ggplo2\n\nggplot(weights, aes(x = reorder(tickers, weights), y = weights, fill = tickers)) +\n  geom_col(color = \"black\", show.legend = FALSE) +\n  theme_minimal(base_size = 14) +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1),\n    plot.title = element_text(hjust = 0.5, size = 20, face = \"bold\"),\n    plot.subtitle = element_text(hjust = 0.5, size = 16),\n    legend.position = \"none\") +\n  scale_fill_viridis_d() +\n  labs(title = \"Distribuição dos Pesos dos Ativos\",\n   x = \"Ativos\",\n   y = \"Pesos\") +\n  coord_flip()"
  },
  {
    "objectID": "otimização.html#realizando-otimização-da-função-de-utilidade-com-o-portfolioanalytics",
    "href": "otimização.html#realizando-otimização-da-função-de-utilidade-com-o-portfolioanalytics",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Realizando otimização da função de utilidade com o PortfolioAnalytics",
    "text": "Realizando otimização da função de utilidade com o PortfolioAnalytics\n\n#criar o objeto de otimização\n\nportf &lt;- portfolio.spec(assets = colnames(asset_returns_xts))\n\n# Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1\n\nportf &lt;- add.constraint(portf, type = \"full_investment\")\n\n# Adicionando restrição de peso mínimo e máximo para cada ativo (0-1)\n\nportf &lt;- add.constraint(portf, type = \"long_only\")\n\n# Adiciona a função objetivo, que é maximizar o retorno esperado\n\nportf &lt;- add.objective(portf, type = \"return\", name = \"mean\")\n\n# Adiciona a função objetivo, que é minimizar a variância da carteira\n\nportf &lt;- add.objective(portf, type = \"risk\", name = \"var\")\n\nportf &lt;- add.objective(portf, type = \"quadratic_utility\", risk_aversion = 10)\n\n# Resolve o problema de otimização\n\nopt_portf &lt;- optimize.portfolio(asset_returns_xts, portf, optimize_method = \"ROI\")\n\n# Extraindo os pesos dos ativos\n\nextractWeights(opt_portf)\n\n     VALE3.SA      PETR4.SA      CMIG4.SA      RADL3.SA      ITUB4.SA \n 3.291017e-01  1.614216e-01  3.206608e-02  4.774106e-01 -1.387779e-17"
  },
  {
    "objectID": "otimização.html#pesos",
    "href": "otimização.html#pesos",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Pesos",
    "text": "Pesos\n\nextractWeights(opt_portf)\n\n     VALE3.SA      PETR4.SA      CMIG4.SA      RADL3.SA      ITUB4.SA \n 3.291017e-01  1.614216e-01  3.206608e-02  4.774106e-01 -1.387779e-17"
  },
  {
    "objectID": "otimização.html#entendendo-a-especificação-do-portfólio",
    "href": "otimização.html#entendendo-a-especificação-do-portfólio",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Entendendo a especificação do portfólio",
    "text": "Entendendo a especificação do portfólio\nO objeto de portfólio é uma lista que contém as seguintes informações:\n\nassets: vetor de nomes dos ativos\nconstraints: lista de restrições\n\nweight_sum: restrição de que a soma dos pesos dos ativos deve ser igual a um valor específico\nfull_investment: restrição de que a soma dos pesos dos ativos deve ser igual a 1\ndollar_neutral: restrição de que a soma dos pesos dos ativos deve ser igual a zero\nbox: restrição de que os pesos dos ativos devem estar dentro de um intervalo específico\nlong_only: restrição de que os pesos dos ativos devem ser maiores ou iguais a zero e menores ou iguais a um (caso especial da restrição box)\ngroup: restrição de que os pesos dos ativos de um grupo específico devem ser iguais\nturnover: restrição de que o turnover da carteira deve ser menor ou igual a um valor específico a partir de uma carteira inicial\ndiversification: Especifica um valor de diversificação para a carteira\nposition_limit: Permite ao usuário definir o número máximo de posições (ativos com pesos não nulos) e o número máximo de posições compradas e vendidas.\nreturn: Especifica o retorno médio esperado da carteira\nfactor_exposure: Especifica a exposição da carteira a fatores de risco\nleverage_exposure: Especifica a alavancagem maxima da carteira onde a alavancagem é definida como a soma dos pesos absolutos dos ativos\n\nobjectives:\n\ntype: ‘return’,‘risk’, ‘risk_budget’, ‘quadratic_utility’, or ’weight_concentration"
  },
  {
    "objectID": "otimização.html#passo-a-passo-da-otimização-de-portfólios",
    "href": "otimização.html#passo-a-passo-da-otimização-de-portfólios",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Passo a passo da otimização de portfólios",
    "text": "Passo a passo da otimização de portfólios\n\nCarregar os preços dos ativos e do benchmark\nConverter os preços diários em preços mensais\nCalcular os retornos mensais dos ativos e do benchmark\nCriar o objeto de portfólio\nAdicionar restrições ao objeto de portfólio\nAdicionar a função objetivo ao objeto de portfólio\nResolver o problema de otimização\nExibir os resultados da otimização\nExibir os pesos dos ativos na carteira otimizada\nPlotar a distribuição dos pesos dos ativos na carteira otimizada"
  },
  {
    "objectID": "otimização.html#criando-um-objeto-para-as-especificações-do-portfólio",
    "href": "otimização.html#criando-um-objeto-para-as-especificações-do-portfólio",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Criando um objeto para as especificações do portfólio",
    "text": "Criando um objeto para as especificações do portfólio\n\n# Criando o objeto de portfólio, aqui estamos apenas especificando os ativos que serão utilizados na otimização\n\nport_spec &lt;- portfolio.spec(assets = colnames(asset_returns_xts))\n\nclass(port_spec)\n\n[1] \"portfolio.spec\" \"portfolio\""
  },
  {
    "objectID": "otimização.html#adicionando-restrições-ao-objeto-de-portfólio",
    "href": "otimização.html#adicionando-restrições-ao-objeto-de-portfólio",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Adicionando restrições ao objeto de portfólio",
    "text": "Adicionando restrições ao objeto de portfólio\nAs restrições são condições que devem ser satisfeitas durante a otimização da carteira. Algumas restrições comuns são relacionadas ao peso dos ativos e ao retorno esperado da carteira.\n\n# Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1\n\nport_spec  &lt;- add.constraint(port_spec, type = \"weight_sum\", min_sum = 1, max_sum = 1)\n\n# adicionnando uma restrição de caixas para os pesos dos ativos\n\nport_spec &lt;- add.constraint(port_spec, type = \"box\", min = c(0.2, 0.1, 0.1, 0.1, 0.1), max = 0.4)\n\n\nport_spec\n\n**************************************************\nPortfolioAnalytics Portfolio Specification \n**************************************************\n\nCall:\nportfolio.spec(assets = colnames(asset_returns_xts))\n\nNumber of assets: 5 \nAsset Names\n[1] \"VALE3.SA\" \"PETR4.SA\" \"CMIG4.SA\" \"RADL3.SA\" \"ITUB4.SA\"\n\nConstraints\nEnabled constraint types\n        - weight_sum \n        - box"
  },
  {
    "objectID": "otimização.html#adicionando-a-função-objetivo-ao-objeto-de-portfólio",
    "href": "otimização.html#adicionando-a-função-objetivo-ao-objeto-de-portfólio",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Adicionando a função objetivo ao objeto de portfólio",
    "text": "Adicionando a função objetivo ao objeto de portfólio\nA função objetivo é a função que será otimizada durante o processo de otimização da carteira. Um objetivo comum é maximizar o retorno esperado da carteira e minimizar a volatilidade e o risco.\nLembre-se que o desvio padrão é a raiz quadrada da variância. E que a variância é a média dos quadrados dos desvios em relação à média. A variancia é geralmente usada para denotar o risco, quanto maior a variancia, maior o risco. Já geralmente denota a volatilidade, quanto maior o desvio padrão, maior a volatilidade. Ambas são medidas que servem como indicadores de risco.\nNo portfolioAnalytics, a função objetivo é adicionada ao objeto de portfólio usando a função add.objective(). Os objetivos mais usado são:\n\nreturn: Maximizar o retorno esperado da carteira\nrisk: Minimizar o risco da carteira\nrisk_budget: Minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira\nquadratic_utility: Maximizar a função de utilidade quadrática da carteira\nweight_concentration: Minimizar a concentração dos pesos dos ativos na carteira\n\n\n# Adiciona a função objetivo, que é maximizar o retorno médio esperado da carteira\n\nport_spec &lt;- add.objective(port_spec, type = \"return\", name = \"mean\")\n\n# Adiciona a função objetivo, que é minimizar o desvio padrão da carteira\n\nport_spec &lt;- add.objective(port_spec, type = \"risk\", name = \"StdDev\")\n\n# Adiciona um objetivo para minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira\n\nport_spec &lt;- add.objective(port_spec, type = \"risk_budget\", name = \"var\", min_prisk = 0.05, max_prisk = 0.1)\n\nprint(port_spec)\n\n**************************************************\nPortfolioAnalytics Portfolio Specification \n**************************************************\n\nCall:\nportfolio.spec(assets = colnames(asset_returns_xts))\n\nNumber of assets: 5 \nAsset Names\n[1] \"VALE3.SA\" \"PETR4.SA\" \"CMIG4.SA\" \"RADL3.SA\" \"ITUB4.SA\"\n\nConstraints\nEnabled constraint types\n        - weight_sum \n        - box \n\nObjectives:\nEnabled objective names\n        - mean \n        - StdDev \n        - var"
  },
  {
    "objectID": "otimização.html#resolvendo-o-problema-de-otimização",
    "href": "otimização.html#resolvendo-o-problema-de-otimização",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Resolvendo o problema de otimização",
    "text": "Resolvendo o problema de otimização\nExistem duas funções principais para resolver o problema de otimização da carteira: optimize.portfolio() e optimize.portfolio.rebalancing(). A função optimize.portfolio() é usada para otimizar a carteira sem rebalanceamento, enquanto a função optimize.portfolio.rebalancing() é usada para otimizar a carteira com rebalanceamento.\nLembre-se que o rebalanceamento é o processo de ajustar os pesos dos ativos na carteira para manter a alocação desejada ao longo do tempo.\nO pacote suporta diversos métodos de otimização, como:\n\nDEoptim: Differential Evolution\nrandom: Random Portfolios\nGenSA: Generalized Simulated Annealing\npso: Particle Swarm Optimization\nROI: R Optimization Infrastructure\n\nO método a ser usado irá depender do problema.\nVamos fazer fazer uma otimização usando o método de portifolios aleatórios. Nosso objetivo é maximizar o retorno esperado da carteira e minimizar o risco onde o risco minimo é 5% e o risco maximo é 10% sujeito a restrições de peso e de grupo.\n\n# .storage &lt;&lt;- new.env()\n\nrp &lt;- random_portfolios(port_spec, permutations = 1000, rp_method = 'simplex')\n\nWarning: executing %dopar% sequentially: no parallel backend registered\n\n# rp &lt;- random_portfolios(port_spec, permutations = 1000, rp_method = 'sample')\n# rp &lt;- random_portfolios(port_spec, permutations = 1000, rp_method = 'grid') \n\nhead(rp)\n\n      VALE3.SA  PETR4.SA  CMIG4.SA  RADL3.SA  ITUB4.SA\n[1,] 0.3224445 0.2402095 0.1655588 0.1200365 0.1517508\n[2,] 0.3110452 0.2437957 0.1778512 0.1055166 0.1617914\n[3,] 0.2315571 0.1019185 0.1904136 0.3282470 0.1478639\n[4,] 0.3011285 0.1867509 0.2018843 0.1481562 0.1620801\n[5,] 0.2624004 0.1637672 0.2152460 0.2017702 0.1568162\n[6,] 0.2027899 0.1553114 0.3381339 0.2026653 0.1010994\n\n\nSimplex: Distribui pesos aleatoriamente em um espaço triangular, garantindo que a soma seja sempre 1. Sample: Seleciona pesos aleatórios de uma distribuição de probabilidade específica. Grid: Gera pesos em pontos pré-definidos de uma grade regular.\n\nopt  &lt;-  optimize.portfolio(R = asset_returns_xts, port_spec, rp = rp, optimize_method = \"random\", trace = TRUE)\n\nLeverage constraint min_sum and max_sum are restrictive, \n              consider relaxing. e.g. 'full_investment' constraint should be min_sum=0.99 and max_sum=1.01\n\nprint(opt)\n\n***********************************\nPortfolioAnalytics Optimization\n***********************************\n\nCall:\noptimize.portfolio(R = asset_returns_xts, portfolio = port_spec, \n    optimize_method = \"random\", trace = TRUE, rp = rp)\n\nOptimal Weights:\nVALE3.SA PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA \n  0.3039   0.1009   0.1000   0.3927   0.1024 \n\nObjective Measures:\n   mean \n0.01596 \n\n\nStdDev \n0.0602 \n\ncontribution :\nVALE3.SA PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA \n0.017699 0.007228 0.006641 0.021894 0.006735 \n\npct_contrib_StdDev :\nVALE3.SA PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA \n  0.2940   0.1201   0.1103   0.3637   0.1119"
  },
  {
    "objectID": "otimização.html#otimizando-a-carteira-com-rebalanceamento",
    "href": "otimização.html#otimizando-a-carteira-com-rebalanceamento",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Otimizando a carteira com rebalanceamento",
    "text": "Otimizando a carteira com rebalanceamento\nA função optimize.portfolio.rebalancing() é usada para otimizar a carteira com rebalanceamento. O rebalanceamento é o processo de ajustar os pesos dos ativos na carteira para manter a alocação desejada ao longo do tempo. O rebalanceamento é importante para garantir que a carteira permaneça alinhada com os objetivos de investimento (restrições e objetivos) ao longo do tempo.\noptimize.portfolio.rebalancing() suporta otimização de carteiras com rebalanceamento em diferentes janelas de tempo. O backtest é o processo de testar uma estratégia de investimento em dados históricos para avaliar seu desempenho.\nOBS: Dependendo do método de otimização, o processo pode ser demorado.\nExemplo de otimização com rebalanceamento:\n\n# Criar o objeto de portfólio\nport_specr &lt;- portfolio.spec(assets = colnames(asset_returns_xts))\n\n# Adicionar restrições - full investment com soma de pesos igual a 1\n\nport_specr &lt;- add.constraint(port_specr, type = \"long_only\")\n\n# restrição para a soma dos pesos\n\nport_specr &lt;- add.constraint(port_specr, type = \"weight_sum\", min_sum = 0.99, max_sum = 1.01)\n\n# Adicionar a função objetivo - maximizar o retorno esperado\n\nport_specr &lt;- add.objective(port_specr, type = \"return\", name = \"mean\")\n\n# Adicionar a função objetivo - minimizar o risco\n\nport_specr &lt;- add.objective(port_specr, type = \"risk\", name = \"StdDev\")\n\n# Adicionar a função objetivo - minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira\n\nport_specr &lt;- add.objective(port_specr, type = \"risk_budget\", name = \"StdDev\", min_prisk = 0.05, max_prisk = 0.1)\n\nrp &lt;- random_portfolios(port_specr, permutations = 50, rp_method = 'simplex')"
  },
  {
    "objectID": "otimização.html#otimização",
    "href": "otimização.html#otimização",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Otimização",
    "text": "Otimização\n\n# Otimização com rebalanceamento mensal\n\nopt_rebal &lt;- optimize.portfolio.rebalancing(R = asset_returns_xts, \n                      portfolio = port_specr, \n                      optimize_method = \"random\",\n                      rp = rp,\n                      trace = TRUE,\n                      search_size = 1000,\n                      rebalance_on = \"months\",\n                      training_period = 12,\n                      rolling_window = 12)\n\nprint(opt_rebal)\n\n**************************************************\nPortfolioAnalytics Optimization with Rebalancing\n**************************************************\n\nCall:\noptimize.portfolio.rebalancing(R = asset_returns_xts, portfolio = port_specr, \n    optimize_method = \"random\", search_size = 1000, trace = TRUE, \n    rp = rp, rebalance_on = \"months\", training_period = 12, rolling_window = 12)\n\nNumber of rebalancing dates:  49 \nFirst rebalance date:\n[1] \"2020-05-31\"\nLast rebalance date:\n[1] \"2024-05-31\"\n\nAnnualized Portfolio Rebalancing Return:\n[1] 0.2548541\n\nAnnualized Portfolio Standard Deviation:\n[1] 0.203243"
  },
  {
    "objectID": "otimização.html#analise-dos-resultados",
    "href": "otimização.html#analise-dos-resultados",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Analise dos resultados",
    "text": "Analise dos resultados\n\nextractObjectiveMeasures(opt_rebal) |&gt; head(1)\n\n                  mean     StdDev StdDev.contribution.VALE3.SA\n2020-05-31 0.006597553 0.08007868                   0.01307995\n           StdDev.contribution.PETR4.SA StdDev.contribution.CMIG4.SA\n2020-05-31                   0.01011723                   0.03263592\n           StdDev.contribution.RADL3.SA StdDev.contribution.ITUB4.SA\n2020-05-31                   0.01457031                  0.009675268\n           StdDev.pct_contrib_StdDev.VALE3.SA\n2020-05-31                          0.1633387\n           StdDev.pct_contrib_StdDev.PETR4.SA\n2020-05-31                          0.1263411\n           StdDev.pct_contrib_StdDev.CMIG4.SA\n2020-05-31                          0.4075482\n           StdDev.pct_contrib_StdDev.RADL3.SA\n2020-05-31                            0.18195\n           StdDev.pct_contrib_StdDev.ITUB4.SA\n2020-05-31                           0.120822\n\nextractWeights(opt_rebal) |&gt; head()\n\n            VALE3.SA  PETR4.SA  CMIG4.SA  RADL3.SA  ITUB4.SA\n2020-05-31 0.2768987 0.0631134 0.2757865 0.2572021 0.1269994\n2020-06-30 0.2768987 0.0631134 0.2757865 0.2572021 0.1269994\n2020-07-31 0.2768987 0.0631134 0.2757865 0.2572021 0.1269994\n2020-08-31 0.2768987 0.0631134 0.2757865 0.2572021 0.1269994\n2020-09-30 0.2768987 0.0631134 0.2757865 0.2572021 0.1269994\n2020-10-31 0.2768987 0.0631134 0.2757865 0.2572021 0.1269994\n\nchart.Weights(opt) \n\n\n\n\n\n\n\nchart.Weights(opt_rebal)"
  },
  {
    "objectID": "otimização.html#plotando-os-pesos-ao-longo-do-tempo-com-ggplot2",
    "href": "otimização.html#plotando-os-pesos-ao-longo-do-tempo-com-ggplot2",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Plotando os pesos ao longo do tempo com ggplot2",
    "text": "Plotando os pesos ao longo do tempo com ggplot2\n\n# Extraindo os pesos dos ativos ao longo do tempo\n\nweights_xts &lt;- extractWeights(opt_rebal)\n\n# Convertendo os pesos para um data frame\n\nweights_df &lt;- weights_xts %&gt;% \n              tk_tbl(preserve_index = TRUE, rename_index = \"Date\")\n\n\n# Colocando o data frame em formato longo\n\nweights_long_df &lt;- weights_df %&gt;% \n                pivot_longer(cols = -Date, names_to = \"Asset\", values_to = \"Weight\")\n\n\nplotly::ggplotly(ggplot(weights_long_df) +\n  aes(x = Date, y = Weight, colour = Asset) +\n  geom_smooth(se = FALSE ) +\n  scale_fill_hue(direction = 1) +\n  labs(\n    x = \"Data\",\n    y = \"Peso\",\n    title = \"Peso dos ativos rebalanceados ao longo do tempo\",\n    colour = \"Ativos\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 16L,\n    face = \"bold\",\n    hjust = 0.5)\n  )\n)\n\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'"
  },
  {
    "objectID": "otimização.html#plotando-o-retorno-do-portfólio-ao-longo-do-tempo",
    "href": "otimização.html#plotando-o-retorno-do-portfólio-ao-longo-do-tempo",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Plotando o retorno do portfólio ao longo do tempo",
    "text": "Plotando o retorno do portfólio ao longo do tempo\n\n# Calculando o retorno do portfólio otimizado e adicionando o retorno do IBOV\nopt_returns_long_df &lt;- Return.portfolio(R = asset_returns_xts, weights = extractWeights(opt_rebal)) %&gt;%\n  tk_tbl(preserve_index = TRUE, rename_index = \"Date\") %&gt;%\n  inner_join(ibov_returns_xts %&gt;% tk_tbl(preserve_index = TRUE, rename_index = \"Date\"), by = \"Date\", suffix = c(\"_Portfolio\", \"_IBOV\")) %&gt;%\n  pivot_longer(cols = -Date, names_to = \"Portfolio\", values_to = \"Return\")\n\nplotly::ggplotly(ggplot(opt_returns_long_df) +\n  aes(x = Date, y = Return, colour = Portfolio) +\n  geom_line() +\n  scale_fill_hue(direction = 1) +\n  labs(\n    x = \"Data\",\n    y = \"Retorno\",\n    title = \"Retorno do portifólio vs IBOV ao longo do tempo\",\n    colour = \"Portfólio\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 16L,\n    face = \"bold\",\n    hjust = 0.5)\n  )\n)"
  },
  {
    "objectID": "otimização.html#bonus-plotando-a-fronteira-eficiente",
    "href": "otimização.html#bonus-plotando-a-fronteira-eficiente",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Bonus: Plotando a fronteira eficiente",
    "text": "Bonus: Plotando a fronteira eficiente\nA fronteira eficiente é uma curva que mostra a combinação ótima de ativos em uma carteira que maximiza o retorno esperado para um determinado nível de risco. Note que o indice de Sharpe é a inclinação da linha tangente a fronteira eficiente, o intercepto com o eixo y é o retorno livre de risco e o ponto de tangência é o ponto com o maior indice de Sharpe.\n\n# Calculando a fronteira eficiente\nfrontier &lt;- create.EfficientFrontier(R = asset_returns_xts, portfolio = port_spec, type = \"mean-StdDev\")\n\n# Plotando a fronteira eficiente\nchart.EfficientFrontier(frontier, match.col = \"StdDev\",n.portfolios = 30, main = \"Fronteira eficiente\")"
  },
  {
    "objectID": "otimização.html#dashboards-interativos-com-quarto",
    "href": "otimização.html#dashboards-interativos-com-quarto",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Dashboards interativos com QUARTO",
    "text": "Dashboards interativos com QUARTO\nClique aqui!!"
  },
  {
    "objectID": "otimização.html#exercício",
    "href": "otimização.html#exercício",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Exercício",
    "text": "Exercício\n\nCrie uma carteira com 5 ativos de sua escolha\nBaixe os preços dos ativos\nCalcule os retornos mensais\nCrie um vetor de pesos para a carteira\nCalcule o retorno da carteira\nFaça a otimização da carteira com o objetivo de maximizar o retorno esperado e minimizar o risco\nOpcionalmente faça a otimização com rebalanceamento\nVisualize o retorno da carteira e dos ativos\nCompare o retorno da carteira com o índice do mercado\nSalve o seu dashboard e compartilhe com o professor"
  },
  {
    "objectID": "otimização.html#dica-use-o-arquivo-das-aulas-anteriores-como-referência-para-criar-o-seu-dashboard",
    "href": "otimização.html#dica-use-o-arquivo-das-aulas-anteriores-como-referência-para-criar-o-seu-dashboard",
    "title": "Aula 2 - Análise e otimização de carteiras",
    "section": "Dica: Use o arquivo das aulas anteriores como referência para criar o seu dashboard",
    "text": "Dica: Use o arquivo das aulas anteriores como referência para criar o seu dashboard"
  },
  {
    "objectID": "exercicios.html",
    "href": "exercicios.html",
    "title": "Mini-curso de finanças com R",
    "section": "",
    "text": "Instruções\nOBS 1 - Caso você não tenha o R instalado em sua máquina, você pode acompanhar o curso através do site: Ambiente Posit Cloud.\nOBS 2 - Caso esteja trabalhando no seu computador, você pode instalar os pacotes necessários para o curso e depois carregar as bibliotecas com o código abaixo:\n\nrequired_packages &lt;- c(\"tidyverse\", \"quantmod\", \"timetk\", \"plotly\", \"PerformanceAnalytics\",\"DT\")\nfor (pkg in required_packages) {\n  if (!require(pkg, character.only = TRUE)) {\n    install.packages(pkg, dependencies = TRUE)\n    library(pkg, character.only = TRUE)\n  }\n}\n\nExercícios\n\nSuponha que uma ação caia 50% e depois suba 50%, de quanto foi a variação total no período? dica (Componha o retorno destes dois períodos utilizando juros compostos.)\n\n\nDeterminado agente possui uma carteira formada pelas seguintes posições: R$25000,00 no ativo A e R$50000,00 no ativo B.\n\nQuais os pesos de sua carteira?\nSe para a manutenção destas posições o agente tivesse emprestado R$40000,00 ao Banco X, qual seria a estrutura dos pesos de sua carteira?\n\nSelecione uma carteira adicionando pelo menos 6 ativos que supere o IBOV em resultados com no máximo 20% a mais de risco.\n\n\nCrie um dashboard com os gráficos com seus dados e gráficos com base na carteira selecionada."
  },
  {
    "objectID": "apresentacao.html#ariel-levy",
    "href": "apresentacao.html#ariel-levy",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Ariel Levy",
    "text": "Ariel Levy\n\n\n\n\n\n\nDoutor em Economia (Universidade Federal Fluminense - 2013), mestre em Administração (IBMEC -2003) e engenheiro eletricista (Universidade Federal Fluminense - 1982). Sou Professor Associado da Universidade Federal Fluminense vinculado ao Departamento de Administração da Faculdade de Administração e Ciências Contábeis e fui coordenador do Curso de Graduação em Administração (2016-2021). Professor do quadro permanente do PPGAd - UFF e colaborador no MBA de Logística (LOGEMP - UFF), no MBA de Finanças (UFF), no MBA de Marketing (UFF) e dos cursos de Extensão em Ciências dos Dados (UFF) como atual coordenador. Possui experiência em Administração, com ênfase em Finanças Quantitativas; Finanças publicas; Planejamento e Controle: Ciências dos Dados: na linguagem R e na análise e visualização de dados. Organizador dos Seminários de Estatística R - Evento Internacional de Divulgação de Aplicações e Desenvolvimento de Linguagens R. Coordenador do Grupo de Pesquisa (CNPQ/UFF) - Métodos Quantitativos Aplicados à Administração."
  },
  {
    "objectID": "apresentacao.html#marcus-ramalho",
    "href": "apresentacao.html#marcus-ramalho",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Marcus Ramalho",
    "text": "Marcus Ramalho\n\n\n\n\n\nPossui mestrado e graduação em Administração pela Universidade Federal Fluminense (UFF), atua como professor nos cursos de formação executiva em Ciências de Dados e Finanças Corporativas e Mercados de Capitais na mesma instituição. Paralelamente, exerce a função de cientista de dados e desenvolvedor de sistemas no projeto Lagoa Viva (UFF/Maricá, RJ). Tem experiência em ciência de dados com R e Python, programação funcional, desenvolvimento de sistemas com Django, visualização de dados e automação de processos administrativos com Python, R e VBA. Seus interesses acadêmicos e profissionais incluem Administração da Informação, Desenvolvimento de sistemas, Economia Política e Finanças, R, Python."
  },
  {
    "objectID": "apresentacao.html#eduardo-camilo",
    "href": "apresentacao.html#eduardo-camilo",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Eduardo Camilo",
    "text": "Eduardo Camilo\n\n\n\n\n\nDoutor em Administração pelo Instituto COPPEAD da UFRJ (2009) e Professor Associado da Universidade Federal Fluminense, onde vem pesquisando nas áreas de Microestrutura de Mercado, Finanças Comportamentais e Inteligência Analítica. Graduado em Engenharia Eletrônica pelo Instituto Militar de Engenharia (1987). Possui certificação CAP® (Certified Analytics Professional). Possui experiência como executivo na área financeira de grandes empresas e consultor em Finanças e Inteligência Analítica. Também leciona nas áreas de Finanças, Métodos Quantitativos, Varejo e Informática em diversas instituições. Autor do livro Finanças Comportamentais - Pessoas Inteligentes Também Perdem Dinheiro na Bolsa de Valores, publicado pela editora Atlas em 2009."
  },
  {
    "objectID": "apresentacao.html#sumário",
    "href": "apresentacao.html#sumário",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Sumário",
    "text": "Sumário\n\nRelembrar conceitos de finanças e aplicar o R na análise e visualização de seu portfólio.\nImportar os preços dos ativos da internet direto do yahoo.com\nTransformar os preços diários em mensais e obter os retornos.\nVisualização dos dados.\nRetorno da carteira\nVisualizar o retorno da carteira.\nAnálise do risco.\nBeta do portfólio e de cada ativo.\nÍndice sharpe\nOtmização de carteiras de ativos"
  },
  {
    "objectID": "apresentacao.html#relembrando-conceitos-de-finanças",
    "href": "apresentacao.html#relembrando-conceitos-de-finanças",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Relembrando conceitos de finanças",
    "text": "Relembrando conceitos de finanças\n\nQual a sua motivação para investir?MotivaçãoRenda variávelOHLC\n\n\n\nQual a motivação para investir?\nJá investiu em renda variável?\nQuais os riscos?\nComo escolher seus ativos?"
  },
  {
    "objectID": "apresentacao.html#importar-os-preços-dos-ativos-da-internet-direto-do-yahoo.com",
    "href": "apresentacao.html#importar-os-preços-dos-ativos-da-internet-direto-do-yahoo.com",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Importar os preços dos ativos da internet direto do yahoo.com",
    "text": "Importar os preços dos ativos da internet direto do yahoo.com\n\nFundamentuscarregar pacotes e selecionar ativosImportar preços dos ativosPrices\n\n\n\n\n\n\n\n\n\n## pacote utilizados\npacotes &lt;- c(\"tidyverse\", \"quantmod\", \"timetk\", \"plotly\", \"PerformanceAnalytics\")\npurrr::walk(pacotes, library, character.only = TRUE)\n\n# Ativos escolhidos\ntickers &lt;- c(\"VALE3.SA\",\"PETR4.SA\",\"CMIG4.SA\",\"RADL3.SA\",\"ITUB4.SA\",\"^BVSP\")\n\n# w &lt;- c(0.15, 0.25, 0.1, 0.2, 0.3)\n\n\n\n\nO Formato XTS\n\n\nprices_raw &lt;- \n  getSymbols(tickers, \n             src = 'yahoo', \n             from = \"2019-12-31\",\n             to = \"2024-05-31\",\n             auto.assign = TRUE, #obs auto asign carrega os resultados para o ambiente\n             warnings = FALSE,)\n\nprices&lt;-prices_raw %&gt;%             \n  map(~Ad(get(.))) %&gt;% \n  reduce(merge) %&gt;%\n  `colnames&lt;-`(tickers)\n\n\n\n\nprices %&gt;%\n  tk_tbl() %&gt;%\n  head()\n\n# A tibble: 6 × 7\n  index      VALE3.SA PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA `^BVSP`\n  &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;\n1 2020-01-02     35.1     10.6     4.08     21.0     30.9  118573\n2 2020-01-03     34.9     10.5     4.04     20.6     30.6  117707\n3 2020-01-06     34.7     10.7     4.10     20.2     30.2  116878\n4 2020-01-07     34.9     10.6     4.25     19.9     29.5  116662\n5 2020-01-08     34.9     10.6     4.36     20.2     29.0  116247\n6 2020-01-09     34.5     10.5     4.33     20.8     28.4  115947"
  },
  {
    "objectID": "apresentacao.html#retornos-de-um-ativo",
    "href": "apresentacao.html#retornos-de-um-ativo",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Retornos de um ativo",
    "text": "Retornos de um ativo\nRetorno Linear = \\(\\frac{P_{t} - P_{t-1}}{P_{t-1}}\\)\nRetorno Logarítmico = \\(ln(\\frac{P_{t}}{P_{t-1}})\\)"
  },
  {
    "objectID": "apresentacao.html#transformar-os-preços-diários-em-mensais-e-obter-os-retornos.",
    "href": "apresentacao.html#transformar-os-preços-diários-em-mensais-e-obter-os-retornos.",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Transformar os preços diários em mensais e obter os retornos.",
    "text": "Transformar os preços diários em mensais e obter os retornos.\n\nPreços mensaisRetornos mensais\n\n\n\nprices_monthly &lt;- xts::to.monthly(prices, indexAt = \"lastof\", OHLC = FALSE)\n\nhead(prices_monthly)\n\n           VALE3.SA PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA  ^BVSP\n2020-01-31 32.50481 9.842995 4.399584 22.77023 26.70970 113761\n2020-02-29 28.65105 8.767011 4.108241 21.97834 26.42990 104172\n2020-03-31 27.94626 4.840193 2.622093 18.69379 19.07977  73020\n2020-04-30 29.00668 6.244852 2.801608 19.24322 18.82757  80506\n2020-05-31 34.27005 7.037136 3.178295 20.09904 19.06339  87403\n2020-06-30 36.15813 7.455766 3.243038 20.34319 21.07114  95056\n\n\n\n\n\nasset_returns_xts &lt;-\n PerformanceAnalytics::Return.calculate(prices_monthly, \n                   method = \"discrete\") %&gt;% \n  na.omit()\nhead(asset_returns_xts)\n\n              VALE3.SA    PETR4.SA    CMIG4.SA    RADL3.SA    ITUB4.SA\n2020-02-29 -0.11855962 -0.10931470 -0.06622052 -0.03477739 -0.01047575\n2020-03-31 -0.02459923 -0.44790836 -0.36174803 -0.14944492 -0.27809908\n2020-04-30  0.03794514  0.29020707  0.06846235  0.02939078 -0.01321795\n2020-05-31  0.18145359  0.12686995  0.13445389  0.04447384  0.01252488\n2020-06-30  0.05509419  0.05948878  0.02037060  0.01214774  0.10531998\n2020-07-31  0.08565810  0.03018290  0.08892893  0.12185876  0.05720469\n                 ^BVSP\n2020-02-29 -0.08429075\n2020-03-31 -0.29904389\n2020-04-30  0.10251986\n2020-05-31  0.08567063\n2020-06-30  0.08755992\n2020-07-31  0.08264602"
  },
  {
    "objectID": "apresentacao.html#visualização-dos-dados",
    "href": "apresentacao.html#visualização-dos-dados",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Visualização dos dados",
    "text": "Visualização dos dados\n\nPreços com quantmodRetornos com ggplot2ggplot2Com plotly\n\n\n\n## Visualizar os preços com quantmod\ngraficoscandle &lt;- chartSeries(head(BVSP, 30), \n            TA = \"addVo()\",\n            type = \"candlesticks\",\n            time.scale = \"years\",)\n\n\n\n\n\n\n\n\n\n\n\nasset_returns_tbl &lt;- asset_returns_xts %&gt;% \n  tk_tbl(rename_index = \"Data\") %&gt;% #converte em um data frame para plotar com ggplot\n  pivot_longer(!\"Data\" ,names_to = \"assets\")#seleciona todas as colunas menos data\n\n#plotando com o ggplot e com o plotly\ng1 &lt;- ggplot(asset_returns_tbl) +\n  aes(x = Data, y = value, colour = assets) +\n  geom_line() +\n  scale_color_hue(direction = 1) +\n  labs(title = \"Retornos de 2019 a 2024\")+ #Aqui nos podemos mudar as legendas\n  theme_minimal()\n\n\n\n\ng1\n\n\n\n\n\n\n\n\n\n\n\nplotly::ggplotly(g1)"
  },
  {
    "objectID": "apresentacao.html#não-sabe-usar-o-ggplot2",
    "href": "apresentacao.html#não-sabe-usar-o-ggplot2",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Não sabe usar o ggplot2?",
    "text": "Não sabe usar o ggplot2?\n\nEsquisseBox Plot dos retornos\n\n\n\nesquisse::esquisser(asset_returns_tbl)\n\n\n\n\n\n\n\n\n\n\n\n\n\npbp &lt;- ggplot(asset_returns_tbl) +\n  aes(x = \"\", y = value, fill = assets) +\n  geom_boxplot() +\n  scale_fill_brewer(palette = \"OrRd\", direction = 1) +\n  labs(\n    x = \"Ativos\",\n    y = \"Retornos\",\n    title = \"Box Plot - Retorno dos ativos\",\n    fill = \"Ativos\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 16L,\n    face = \"bold\",\n    hjust = 0.5),\n    axis.title.y = element_text(face = \"bold\"),\n    axis.title.x = element_text(face = \"bold\")\n  )\n\npbp"
  },
  {
    "objectID": "apresentacao.html#retorno-da-carteira.",
    "href": "apresentacao.html#retorno-da-carteira.",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Retorno da carteira.",
    "text": "Retorno da carteira.\n\nPesos dos ativosRetorno da carteira\n\n\nO somatório dos pesos deve ser igual a 1.\n\nset.seed(1234) \nw &lt;- runif(5) # Gerando 4 pesos aleatórios\nw &lt;- w / sum(w) # Normalizando os pesos para que a soma seja 1\nw\n\n[1] 0.04018396 0.21992701 0.21532396 0.22030871 0.30425636\n\n\nO cálculo do retorno de uma carteira depende do retorno de cada ativo e de seu peso na carteira e pode ser obtido pela média ponderada:\n\\[ \\bar{k}=\\sum_{i=i}^n{w_i*k_i}\\]\n\n\n\n# removendo o índice do IBOV da lista de ativos para calcular o retorno da carteira\nretorno_ativos &lt;- asset_returns_xts[, tickers[1:5]]\n\nportfolio_returns_xts&lt;-PerformanceAnalytics::Return.portfolio(retorno_ativos,\n                 weights = w,\n                 rebalance_on = \"months\",\n                 type= \"discrete\",\n                 verbose = FALSE) %&gt;% \n  `colnames&lt;-`(\"CARTEIRA\")\nhead(portfolio_returns_xts,3)\n\n              CARTEIRA\n2020-02-29 -0.05391339\n2020-03-31 -0.29492609\n2020-04-30  0.08254415"
  },
  {
    "objectID": "apresentacao.html#visualizar-o-retorno-da-carteira.",
    "href": "apresentacao.html#visualizar-o-retorno-da-carteira.",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Visualizar o retorno da carteira.",
    "text": "Visualizar o retorno da carteira.\n\nRetorno da carteiraCódigosAtivos vs CarteiraMercado vs Carteira\n\n\n\nplot(portfolio_returns_xts)\n\n\n\n\n\n\n\n\n\n\n\ncomparacao &lt;- cbind(asset_returns_xts, portfolio_returns_xts) %&gt;% \n  tk_tbl(rename_index = \"Data\") %&gt;% \n  pivot_longer(-Data, names_to = \"assets\", values_to = \"value\")\n\np &lt;- ggplot(comparacao, aes(x = Data, y = value, colour = assets)) +\n  geom_line() +\n  scale_color_hue(direction = 1) +\n  labs(\n    x = \"Data\",\n    y = \"Retornos\",\n    title = \"Retorno dos ativos vs carteira\",\n    colour = \"Ativos\"  \n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 16L, face = \"bold\", hjust = 0.5),\n    axis.title.y = element_text(face = \"bold\"),\n    axis.title.x = element_text(face = \"bold\")\n  )\n\ncomp_mkt &lt;- comparacao %&gt;%\n filter(assets %in% c(\"X.BVSP\", \"CARTEIRA\")) %&gt;%\n ggplot() +\n  aes(x = Data, y = value, colour = assets) +\n  geom_line() +\n  scale_color_hue(direction = 1) +\n  labs(title = \"Carteira VS Índice do mercado - 2020 - 2023\",\n        x = \"Data\",\n        y = \"Retornos\",\n        colour = \"Ativos\"  \n  )+\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 16L, face = \"bold\", hjust = 0.5),\n    axis.title.y = element_text(face = \"bold\"),\n    axis.title.x = element_text(face = \"bold\")\n  )\n\n\n\n\nggplotly(p)\n\n\n\n\n\n\n\n\nggplotly(comp_mkt)"
  },
  {
    "objectID": "apresentacao.html#análise-do-risco.",
    "href": "apresentacao.html#análise-do-risco.",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Análise do risco.",
    "text": "Análise do risco.\n\nDesvio padrãoDistribuição padronizadaRisco do ativoRisco vs Retorno\n\n\n\\[\\bar{X}=\\sum_{i=1}^n{\\pi_iX_i}\\]\n\n# desvio padrao dos precos dos ativos\n\nmean_value &lt;- mean(asset_returns_tbl$value, na.rm = TRUE)\nsd_value &lt;- sd(asset_returns_tbl$value, na.rm = TRUE)\n\ndistribuicaodp &lt;- plotly::ggplotly(asset_returns_tbl %&gt;%\n  filter(assets %in% \"PETR4.SA\") %&gt;%\n  mutate(faixa_inferior = if_else(value &lt; (mean_value - sd_value), value, as.numeric(NA)),\n         faixa_superior = if_else(value &gt; (mean_value + sd_value), value, as.numeric(NA)),\n         faixa_central = if_else(value &gt; (mean_value - sd_value) & value &lt; (mean_value + sd_value), value, as.numeric(NA))) %&gt;%\n  ggplot() +\n  geom_point(aes(x = Data, y = faixa_inferior), color = \"red\") +\n  geom_point(aes(x = Data, y = faixa_superior), color = \"green\") +\n  geom_point(aes(x = Data, y = faixa_central), color = \"blue\") +\n  geom_hline(yintercept = (mean_value + sd_value), color = \"purple\", linetype = \"dotted\") +\n  geom_hline(yintercept = (mean_value - sd_value), color = \"purple\", linetype = \"dotted\") +\n  labs(\n    x = \"Data\",\n    y = \"Retornos\",\n    title = \"Distribuição padronizada - PETR4.SA\",\n    color = \"Ativo\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 16L, face = \"bold\", hjust = 0.5),\n    axis.title.y = element_text(face = \"bold\"),\n    axis.title.x = element_text(face = \"bold\")\n  ))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\\[ CV= \\frac{\\sigma}{\\bar{K}}\\]\n\n\n\n# Cria o data frame risco_retorno\nrisco_retorno &lt;- cbind(asset_returns_xts, portfolio_returns_xts) %&gt;% \n  tk_tbl(preserve_index = FALSE) %&gt;%\n  summarise(across(everything(), list(Desvio_padrao = sd, Retorno_Medio = mean, Risco = ~sd(.)/mean(.)))) %&gt;% \n  pivot_longer(cols = everything(), names_to = \"Ativo\", values_to = \"Valor\") %&gt;%\n  separate(Ativo, into = c(\"Ativo\", \"Medida\"), sep = \"_\", extra = \"drop\") %&gt;%\n  pivot_wider(names_from = \"Medida\", values_from = \"Valor\")\n\npesos_ativos &lt;- tibble(Ativo = tickers[1:5], Peso = w)\npesos_ativos &lt;- pesos_ativos %&gt;% add_row(Ativo = \"CARTEIRA\", Peso = 1)\n\n\n\n# Junta o novo data frame ao data frame risco_retorno\nrisco_retorno &lt;- risco_retorno %&gt;%\n  left_join(pesos_ativos, by = \"Ativo\")\n\n# Cria o gráfico\nrr &lt;- plotly::ggplotly(risco_retorno %&gt;%\n  ggplot(aes(x = Risco, y = Retorno, colour = Ativo, size = Peso)) +\n  geom_point() +\n  scale_color_hue(direction = 1) +\n  labs(title = \"Risco vs Retorno dos Ativos\", size = \"Pesos e\", colour = \"ativos\") +\n  theme_minimal() +\n  theme(plot.title = element_text(size = 16L, face = \"bold\", hjust = 0.5)))"
  },
  {
    "objectID": "apresentacao.html#beta",
    "href": "apresentacao.html#beta",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Beta",
    "text": "Beta\n\nBeta da carteira e de cada ativo.Beta vs RetornoGráfico - Beta vs Retorno\n\n\n\n# Calculando o beta do portfólio e de cada ativo\n\nbeta_long &lt;- PerformanceAnalytics::CAPM.beta(cbind(asset_returns_xts, portfolio_returns_xts), asset_returns_xts$'^BVSP', Rf = 0) %&gt;%\n  as.data.frame() %&gt;%\n  rownames_to_column(var = \"indice\") %&gt;%\n  pivot_longer(cols = -indice, names_to = \"Ativo\", values_to = \"beta\") %&gt;%\n  select(-indice) %&gt;% \n  inner_join(risco_retorno, by = \"Ativo\") %&gt;%\n  select(Ativo,Desvio, beta, Risco, Retorno)\n\nbeta_long\n\n# A tibble: 7 × 5\n  Ativo    Desvio  beta Risco Retorno\n  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;\n1 VALE3.SA 0.0950 0.620  5.78 0.0164 \n2 PETR4.SA 0.123  1.31   3.72 0.0331 \n3 CMIG4.SA 0.0988 0.985  4.99 0.0198 \n4 RADL3.SA 0.0747 0.627 14.8  0.00506\n5 ITUB4.SA 0.0951 1.06  13.0  0.00731\n6 X.BVSP   0.0737 1.00  17.1  0.00431\n7 CARTEIRA 0.0778 0.986  5.00 0.0155 \n\n\n\n\n\nbeta &lt;- plotly::ggplotly(ggplot(beta_long) +\n  aes(y = Retorno, x = beta, colour = Ativo) +\n  geom_point() +\n  scale_color_hue(direction = 1) +\n  labs(y = \"Retorno\", x = \"Beta\", title = \"Beta vs Retorno\") +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 16L,\n    face = \"bold\",\n    hjust = 0.5)\n  ))\n\n\n\n\nbeta"
  },
  {
    "objectID": "apresentacao.html#indice-sharpe",
    "href": "apresentacao.html#indice-sharpe",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Indice sharpe",
    "text": "Indice sharpe\n\\[ SR = \\frac{R_p - R_f}{\\sigma_p}\\]\nOnde \\(R_p\\) é o retorno da carteira, \\(R_f\\) é a taxa livre de risco e \\(\\sigma_p\\) é o desvio padrão da carteira.\n\n# Calculando o índice sharpe com perfomance analytics\n\nsharpe_carteira &lt;- PerformanceAnalytics::SharpeRatio(portfolio_returns_xts, Rf = 0, p = 0.95, FUN = \"StdDev\")\n\nsharpe_ativos &lt;- PerformanceAnalytics::SharpeRatio(asset_returns_xts, Rf = 0, p = 0.95, FUN = \"StdDev\")\n\nsharpe_carteira\n\n                               CARTEIRA\nStdDev Sharpe (Rf=0%, p=95%): 0.1998465\n\nsharpe_ativos %&gt;% head()\n\n                               VALE3.SA PETR4.SA  CMIG4.SA   RADL3.SA\nStdDev Sharpe (Rf=0%, p=95%): 0.1729674 0.269119 0.2003738 0.06769498\n                                ITUB4.SA      ^BVSP\nStdDev Sharpe (Rf=0%, p=95%): 0.07693524 0.05850082"
  },
  {
    "objectID": "apresentacao.html#função-de-utilidade-quadrática",
    "href": "apresentacao.html#função-de-utilidade-quadrática",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Função de utilidade quadrática",
    "text": "Função de utilidade quadrática\nA função de utilidade quadrática é usada na otimização de portfólios para maximizar o retorno esperado e minimizar o risco.\n\\[U = \\mu^T w - \\lambda \\sigma^2\\]\nonde: - \\(U\\): função de utilidade - \\(\\mu^T\\): vetor de retornos esperados - \\(w\\): vetor de pesos dos ativos - \\(\\lambda\\): fator de aversão ao risco\nGeneralizando para o caso de \\(n\\) ativos, a função de utilidade quadrática é dada por:\n\\[U = \\mu^T w - \\lambda w^T \\Sigma w\\]\nonde: - \\(\\Sigma\\): matriz de covariância dos retornos dos ativos - \\(w^T\\): vetor transposto de pesos dos ativos - \\(w\\): vetor de pesos dos ativos - \\(\\lambda\\): fator de aversão ao risco - \\(\\mu\\): vetor de retornos esperados - \\(U\\): função de utilidade"
  },
  {
    "objectID": "apresentacao.html#otimização-de-portfólios",
    "href": "apresentacao.html#otimização-de-portfólios",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Otimização de portfólios",
    "text": "Otimização de portfólios\nA otimização de portfólios é um problema de maximização da função de utilidade quadrática sujeita a restrições, como a soma dos pesos dos ativos deve ser igual a 1 e os pesos dos ativos devem ser maiores ou iguais a zero."
  },
  {
    "objectID": "apresentacao.html#passos-para-otimização-de-portfólios-com-o-pacote-portfolioanalytics",
    "href": "apresentacao.html#passos-para-otimização-de-portfólios-com-o-pacote-portfolioanalytics",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Passos para otimização de portfólios com o pacote PortfolioAnalytics",
    "text": "Passos para otimização de portfólios com o pacote PortfolioAnalytics\n\nCriar o obejto de portfólio\nAdicionar restrições\nAdicionar a função objetivo\nResolver o problema de otimização\nVisualizar os resultados\nExibir os pesos dos ativos\nPlotar a distribuição dos pesos na carteira otimizada"
  },
  {
    "objectID": "apresentacao.html#exemplo-prático---criação-do-objeto-de-portfólio",
    "href": "apresentacao.html#exemplo-prático---criação-do-objeto-de-portfólio",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Exemplo prático - Criação do objeto de portfólio",
    "text": "Exemplo prático - Criação do objeto de portfólio\n\n# removendo bvsp da lista de ativos\n\nasset_returns_xts &lt;- asset_returns_xts[, tickers[1:5]]\n\nlibrary(PortfolioAnalytics)\n\nport_spec &lt;- portfolio.spec(assets = colnames(asset_returns_xts))\n\nclass(port_spec)\n\n[1] \"portfolio.spec\" \"portfolio\""
  },
  {
    "objectID": "apresentacao.html#adicionando-restrições",
    "href": "apresentacao.html#adicionando-restrições",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Adicionando restrições",
    "text": "Adicionando restrições\n\n# Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1\n\nport_spec  &lt;- add.constraint(port_spec, type = \"weight_sum\", min_sum = 1, max_sum = 1)\n\n# adicionnando uma restrição de caixas para os pesos dos ativos\n\nport_spec &lt;- add.constraint(port_spec, type = \"box\", min = c(0.2, 0.1, 0.1, 0.1, 0.1), max = 0.4)\n\n\nport_spec\n\n**************************************************\nPortfolioAnalytics Portfolio Specification \n**************************************************\n\nCall:\nportfolio.spec(assets = colnames(asset_returns_xts))\n\nNumber of assets: 5 \nAsset Names\n[1] \"VALE3.SA\" \"PETR4.SA\" \"CMIG4.SA\" \"RADL3.SA\" \"ITUB4.SA\"\n\nConstraints\nEnabled constraint types\n        - weight_sum \n        - box"
  },
  {
    "objectID": "apresentacao.html#adicionando-a-função-objetivo",
    "href": "apresentacao.html#adicionando-a-função-objetivo",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Adicionando a função objetivo",
    "text": "Adicionando a função objetivo\nNo portfolioAnalytics, a função objetivo é adicionada ao objeto de portfólio usando a função add.objective(). Os objetivos mais usado são:\nreturn: Maximizar o retorno esperado da carteira risk: Minimizar o risco da carteira risk_budget: Minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira quadratic_utility: Maximizar a função de utilidade quadrática da carteira weight_concentration: Minimizar a concentração dos pesos dos ativos na carteira\n\n# Adiciona a função objetivo, que é maximizar o retorno médio esperado da carteira\n\nport_spec &lt;- add.objective(port_spec, type = \"return\", name = \"mean\")\n\n# Adiciona a função objetivo, que é minimizar o desvio padrão da carteira\n\nport_spec &lt;- add.objective(port_spec, type = \"risk\", name = \"StdDev\")\n\n# Adiciona um objetivo para minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira\n\nport_spec &lt;- add.objective(port_spec, type = \"risk_budget\", name = \"var\", min_prisk = 0.05, max_prisk = 0.1)\n\nprint(port_spec)\n\n**************************************************\nPortfolioAnalytics Portfolio Specification \n**************************************************\n\nCall:\nportfolio.spec(assets = colnames(asset_returns_xts))\n\nNumber of assets: 5 \nAsset Names\n[1] \"VALE3.SA\" \"PETR4.SA\" \"CMIG4.SA\" \"RADL3.SA\" \"ITUB4.SA\"\n\nConstraints\nEnabled constraint types\n        - weight_sum \n        - box \n\nObjectives:\nEnabled objective names\n        - mean \n        - StdDev \n        - var"
  },
  {
    "objectID": "apresentacao.html#o-problema-de-otimização",
    "href": "apresentacao.html#o-problema-de-otimização",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "O problema de otimização",
    "text": "O problema de otimização\nExistem duas funções principais para resolver o problema de otimização da carteira: optimize.portfolio() e optimize.portfolio.rebalancing().\nO pacote suporta diversos métodos de otimização, como:\nDEoptim: Differential Evolution random: Random Portfolios GenSA: Generalized Simulated Annealing pso: Particle Swarm Optimization ROI: R Optimization Infrastructure\nO método a ser usado irá depender do problema."
  },
  {
    "objectID": "apresentacao.html#resolvendo-o-problema-de-otimização",
    "href": "apresentacao.html#resolvendo-o-problema-de-otimização",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Resolvendo o problema de otimização",
    "text": "Resolvendo o problema de otimização\nVamos fazer fazer uma otimização usando o método de portifolios aleatórios. Nosso objetivo é maximizar o retorno esperado da carteira e minimizar o risco onde o risco minimo é 5% e o risco maximo é 10% sujeito a restrições de peso e de grupo.\n\nrp &lt;- random_portfolios(port_spec, permutations = 1000, rp_method = 'simplex')\n\nhead(rp)\n\n      VALE3.SA  PETR4.SA  CMIG4.SA  RADL3.SA  ITUB4.SA\n[1,] 0.2410081 0.1648103 0.2115307 0.1059757 0.2766752\n[2,] 0.2599035 0.3124688 0.2154415 0.1071449 0.1050413\n[3,] 0.2056617 0.1523450 0.1287230 0.2565653 0.2567051\n[4,] 0.3595421 0.2381104 0.1106869 0.1315935 0.1600672\n[5,] 0.2128628 0.1369153 0.3246433 0.1367817 0.1887969\n[6,] 0.3652988 0.1056308 0.1370798 0.1525072 0.2394834"
  },
  {
    "objectID": "apresentacao.html#resultados-da-otimização",
    "href": "apresentacao.html#resultados-da-otimização",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Resultados da otimização",
    "text": "Resultados da otimização\n\nopt  &lt;-  optimize.portfolio(R = asset_returns_xts, port_spec, rp = rp, optimize_method = \"random\", trace = TRUE)\n\nprint(opt)\n\n***********************************\nPortfolioAnalytics Optimization\n***********************************\n\nCall:\noptimize.portfolio(R = asset_returns_xts, portfolio = port_spec, \n    optimize_method = \"random\", trace = TRUE, rp = rp)\n\nOptimal Weights:\nVALE3.SA PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA \n  0.3222   0.1031   0.1000   0.3647   0.1101 \n\nObjective Measures:\n   mean \n0.01334 \n\n\n StdDev \n0.06398 \n\ncontribution :\nVALE3.SA PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA \n0.020825 0.007879 0.007320 0.020219 0.007740 \n\npct_contrib_StdDev :\nVALE3.SA PETR4.SA CMIG4.SA RADL3.SA ITUB4.SA \n  0.3255   0.1231   0.1144   0.3160   0.1210"
  },
  {
    "objectID": "apresentacao.html#extraindo-os-pesos-dos-ativos",
    "href": "apresentacao.html#extraindo-os-pesos-dos-ativos",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Extraindo os pesos dos ativos",
    "text": "Extraindo os pesos dos ativos\n\n# extraindo os pesos para um data frame\nweights &lt;- extractWeights(opt)\n\n# Adicionando os nomes dos ativos sem colocá-los no índice\nweights &lt;- data.frame(tickers = colnames(asset_returns_xts), weights, row.names = NULL)\n\nweights\n\n   tickers   weights\n1 VALE3.SA 0.3221855\n2 PETR4.SA 0.1030775\n3 CMIG4.SA 0.1000000\n4 RADL3.SA 0.3646728\n5 ITUB4.SA 0.1100641"
  },
  {
    "objectID": "apresentacao.html#distribuição-dos-pesos",
    "href": "apresentacao.html#distribuição-dos-pesos",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Distribuição dos pesos",
    "text": "Distribuição dos pesos\n\nggplot(weights, aes(x = reorder(tickers, weights), y = weights, fill = tickers)) +\n  geom_col(color = \"black\", show.legend = FALSE) +\n  theme_minimal(base_size = 14) +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1),\n    plot.title = element_text(hjust = 0.5, size = 20, face = \"bold\"),\n    plot.subtitle = element_text(hjust = 0.5, size = 16),\n    legend.position = \"none\") +\n  scale_fill_viridis_d() +\n  labs(title = \"Distribuição dos Pesos dos Ativos\",\n   x = \"Ativos\",\n   y = \"Pesos\") +\n  coord_flip()"
  },
  {
    "objectID": "apresentacao.html#conclusão",
    "href": "apresentacao.html#conclusão",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Conclusão",
    "text": "Conclusão\n\nNeste tutorial, aprendemos a importar preços de ativos da internet, transformar os preços diários em mensais e obter os retornos.\nVisualizamos os dados com ggplot2 e plotly, calculamos o retorno da carteira e visualizamos o retorno\nAnalisamos o risco dos ativos e da carteira, calculamos o beta do portfólio e de cada ativo e o índice sharpe.\nPor fim, otimizamos a carteira de ativos com o pacote PortfolioAnalytics."
  },
  {
    "objectID": "apresentacao.html#e-tem-mais-ser-2025",
    "href": "apresentacao.html#e-tem-mais-ser-2025",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "E tem mais… SER 2025",
    "text": "E tem mais… SER 2025"
  },
  {
    "objectID": "apresentacao.html#e-tem-mais-coisa-ainda",
    "href": "apresentacao.html#e-tem-mais-coisa-ainda",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "E tem mais coisa ainda…",
    "text": "E tem mais coisa ainda…"
  },
  {
    "objectID": "apresentacao.html#contato",
    "href": "apresentacao.html#contato",
    "title": "PROCESSO DE OTIMIZAÇÃO DE UMA CARTEIRA DE ATIVOS UTILIZANDO A LINGUAGEM R",
    "section": "Contato",
    "text": "Contato\n\nMarcus Ramalho:\n\nGitHub\nE-mail: marcusantonio@id.uff.br\nlinkedin: Marcus Ramalho\n\nAriel Levy:\n\nGitHub\nE-mail: alevy@id.uff.br\nlinkedin: Ariel Levy\n\nEduardo Camilo:\n\nGitHub\nE-mail: ecamilo@id.uff.br\nlinkedin: Eduardo Camilo\n\n\n\n\n\n\nPPGAd Universidade Federal Fluminense\n\n\n\n\n\n\n\n \n\n\nXI Xornada de Usuarios de R en Galicia"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Mini-curso de finanças com R",
    "section": "",
    "text": "Neste curso você aprenderá a utilizar o R para análise de dados financeiros. O curso terá duração de 3 horas e será apresentado seguindo o roteiro abaixo:\n\nRelembrar conceitos de finanças e aplicar o R na análise e visualização de seu portfólio.\nImportar os preços dos ativos da internet direto do yahoo.com\nTransformar os preços diários em mensais e obter os retornos.\nVisualização dos dados.\nRetorno da carteira\nVisualizar o retorno da carteira.\nAnálise do risco.\nBeta do portfólio e de cada ativo.\nÍndice sharpe\n\n\n\nEsperamos que você já tenha tido contato com R e Quarto. Um computador com acesso à internet para acessar o ambiente de desenvolvimento Posit Cloud ou baixar o repositorio do curso.\n\n\n\nPara se preparar para o curso, você pode baixar o repositório do curso no link abaixo:\nRepositório no GitHub\nLink para o ambiente de desenvolvimento Posit Cloud\n\n\n\nTidyverse (Wickham et al. 2019), Quantmod(Ryan and Ulrich 2023), timetk (Dancho and Vaughan 2023), plotly (Sievert 2020), PerformanceAnalytics (Peterson and Carl 2020), DT (Xie, Cheng, and Tan 2024) e Reproducible Finance with R (Regenstein 2019)"
  },
  {
    "objectID": "index.html#pré-requisitos",
    "href": "index.html#pré-requisitos",
    "title": "Mini-curso de finanças com R",
    "section": "",
    "text": "Esperamos que você já tenha tido contato com R e Quarto. Um computador com acesso à internet para acessar o ambiente de desenvolvimento Posit Cloud ou baixar o repositorio do curso."
  },
  {
    "objectID": "index.html#preparação",
    "href": "index.html#preparação",
    "title": "Mini-curso de finanças com R",
    "section": "",
    "text": "Para se preparar para o curso, você pode baixar o repositório do curso no link abaixo:\nRepositório no GitHub\nLink para o ambiente de desenvolvimento Posit Cloud"
  },
  {
    "objectID": "index.html#lista-dos-pacotes-e-livros-usados-na-elaboração-deste-curso",
    "href": "index.html#lista-dos-pacotes-e-livros-usados-na-elaboração-deste-curso",
    "title": "Mini-curso de finanças com R",
    "section": "",
    "text": "Tidyverse (Wickham et al. 2019), Quantmod(Ryan and Ulrich 2023), timetk (Dancho and Vaughan 2023), plotly (Sievert 2020), PerformanceAnalytics (Peterson and Carl 2020), DT (Xie, Cheng, and Tan 2024) e Reproducible Finance with R (Regenstein 2019)"
  }
]